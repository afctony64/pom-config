---
name: Batch Enum Field Classifier
id: enum_batch_classifier
description: |
  Batch classification of ALL EnumCat fields in a single LLM call.

  Replaces sequential per-field classification with batched approach.
  Fields and enum values are injected dynamically from schema - no hardcoding.

  AI Tool Type: Prompt
  Stage: post_execution

  Performance: Reduces N LLM calls to 1, saving ~80% of enum_cat execution time.

classification:
  task_type: classification
  complexity: medium
  context_size: medium
  priority: speed

inputs:
  context:
    type: string
    description: Research context from all LLM fields for classification
  enum_config:
    type: object
    description: |
      Dynamic field configs from get_enum_cat_config().
      Structure: {field_name: {enum_values: [...], description: "..."}}
  _rendered_system_message:
    type: string
    description: System message from parent prompt (researcher context)
  researcher_example:
    type: object
    description: Filtered example showing expected input->output for Cat fields

model:
  api: chat
  configuration:
    type: openai_chat
    model_card_id: gpt-5-mini
  parameters:
    max_tokens: 4000
<<<<<<< Updated upstream
    response_format:
      type: json_object
=======
>>>>>>> Stashed changes

---

system:
{% if _rendered_system_message %}
## Researcher Context
{{ _rendered_system_message[:2000] }}{% if _rendered_system_message|length > 2000 %}
... (truncated){% endif %}

---
{% endif %}

You are a **Classification Specialist**. Your task is to classify a company across MULTIPLE category fields in a single response.

## Classification Guidelines

1. **Semantic Matching**: Match the MEANING and CONCEPT, not just keywords. The context may use different words than the option names.
2. **Best Fit**: Choose the option that BEST REPRESENTS the company's characteristics described in the context.
3. **Primary Focus**: If multiple options could apply to a field, choose the PRIMARY or MOST ACCURATE one.
4. **Exact Values**: Use ONLY the exact option values provided for each field.
5. **Unknown Only**: Use "Unknown" ONLY if the context provides insufficient information for that specific field.
6. **Independent Fields**: Classify each field independently based on the context - they may have different confidence levels.

{% if researcher_example %}
## Example Classifications

Given similar context, expected classifications would be:

```json
{{ researcher_example | tojson(indent=2) }}
```
{% endif %}

## Response Format

Return a JSON object with one key per field. Each value MUST be from that field's valid options list.

user:
## Research Context

{{ context }}

## Classification Fields

Classify the company for each of the following {{ enum_config | length }} fields:

{% for field_name, config in enum_config.items() %}
### {{ field_name }}
{{ config.description if config.description else "Select the best matching category" }}

**Valid options:** {{ config.enum_values | join(", ") }}

{% endfor %}

## Your Classifications

Return a JSON object with exactly {{ enum_config | length }} fields:

```json
{
{% for field_name, config in enum_config.items() %}
  "{{ field_name }}": "<value from valid options>"{% if not loop.last %},{% endif %}

{% endfor %}
}
```
