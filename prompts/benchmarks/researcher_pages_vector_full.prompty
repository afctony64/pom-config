---
name: Researcher with Pages (Vector Full Coverage)
description: >
  Benchmark variant: VECTOR SEARCH with FULL COVERAGE.
  Uses hybrid semantic search with higher limits for comprehensive coverage.
  
  Strategy comparison:
  - researcher_pages_vector.prompty: 20 pages, alpha=0.7
  - THIS FILE: 100 pages, alpha=0.8 (more vector-focused)
  
  Higher alpha (0.8) = more semantic relevance
  Higher limit (100) = full coverage for most domains

inputs:
  record:
    description: Company record data to analyze
    type: object
  researcher_id:
    description: Dynamic researcher ID (e.g., company_research_industry) - REQUIRED
    type: string
  persona_id:
    description: Optional persona ID for adaptations
    type: string
    default: null
  pageData:
    description: Injected page content from vector search
    type: array
    default: null
  edgarData:
    description: SEC Edgar financial data (for public companies only)
    type: object
    default: null

data_requirements:
  injectors:
    # üìÑ Page Content Injection - VECTOR FULL COVERAGE STRATEGY
    # Higher alpha (0.8) for semantic focus, high limit (100) for coverage
    # search_query loaded from researcher_ai config (pom-core#128 fixed)
    - injector_template: page_content_vector
      template_vars:
        domain: "{{ record.properties.domain if record.properties else record.domain }}"
        researcher_type: "{{ record._researcher_id }}"
        search_query: "product features capabilities platform solution how it works use cases demo tour getting started key features functionality"
        limit: 100
        alpha: 0.8
        inject_as: pageData
    # üìä SEC Edgar data for public companies
    - injector_template: mcp
      template_vars:
        tool: edgar_company_facts
        params:
          cik: "{{ record.stockSymbol }}"
        inject_as: edgarData
    - injector_template: mcp
      template_vars:
        tool: edgar_filing_sections
        params:
          cik: "{{ record.stockSymbol }}"
          researcher_type: "{{ record._researcher_id }}"
        inject_as: edgarSections

model:
  api: responses
  configuration:
    type: openai_responses
    model: gpt-5-mini  # OpenAI flagship model
  parameters:
    response_format:
      type: json_schema
      json_schema:
        name: researcher_output
        strict: true
        schema:
          type: object
          properties: {}
          required: []
          additionalProperties: false

processing_config:
  source_collection: Company_source
  schema_ids:
    - Company_research_industry
  required_processing_flags:
    researcher_processing_status: null
  max_turns: 15
  iteration_parameter: researcher_id
  iteration_values: "ALL_RESEARCHERS"

post_execution_tools:
  - classify_all

quality_control:
  output_validation:
    enabled: true
    required_fields: []
    field_completeness_threshold: 0.85
    content_quality_checks:
      min_content_length: 10
      max_null_fields: 2
      confidence_score_range: [0.0, 1.0]
      required_quality_fields: ["sourceQuality", "analysisConfidence", "reviewFlag"]

  researcher_scoring:
    enabled: true
    score_fields: ["analysisConfidence", "sourceQuality", "reviewFlag"]
    completeness_scoring: true
    quality_metrics:
      - field_population_rate
      - content_richness_score
      - validation_pass_rate
      - data_source_quality

  audit_trail:
    track_data_sources: true
    track_processing_time: true
    track_validation_results: true
    include_metadata: true
    performance_thresholds:
      max_processing_time: 90
      min_confidence_score: 0.3
---

system:
{% if researcher %}
## üéØ RESEARCHER IDENTITY

{% if researcher.description %}
{{ researcher.description }}
{% else %}
You are a **Business Intelligence Analyst** specializing in company research.
{% endif %}

{% if researcher.name %}
**Researcher**: {{ researcher.name }}
{% endif %}

{% if researcher.id %}
**Collection**: {{ researcher.id }}
{% endif %}

{% else %}
You are a **Business Intelligence Analyst** specializing in company research.
{% endif %}

{% if tenant %}
## üè¢ TENANT CONTEXT

{% if tenant.name %}
**Tenant**: {{ tenant.name }}
{% endif %}
{% if tenant.description %}
**Context**: {{ tenant.description }}
{% endif %}
{% if tenant.analysis_config and tenant.analysis_config.mission %}
**Mission**: {{ tenant.analysis_config.mission }}
{% endif %}
{% if tenant.analysis_config and tenant.analysis_config.industry_focus %}
**Industry Focus**: {{ tenant.analysis_config.industry_focus | join(', ') }}
{% endif %}

**Domain Adaptation**: Use the tenant context above to adapt your terminology. 
Generate domain-appropriate language that matches how this tenant's industry 
describes organizations, market segments, and business characteristics.
{% endif %}

## üìã ANALYSIS CONTEXT

{% if record %}
{% set props = record.properties if record.properties else record %}
**Company Information:**
- **Name**: {{ props.get('accountName') or props.get('domain') or 'Unknown' }}
- **Domain**: {{ props.get('domain') or props.get('url') or 'Not provided' }}
- **Industry**: {{ props.get('industry', 'To be determined') }}
- **Description**: {{ props.get('description') or props.get('company_description') or 'No description available' }}
{% endif %}

{% if pageData and pageData|length > 0 %}
## üìÑ PRIMARY SOURCE: PAGE CONTENT (Vector Full Coverage - {{ pageData|length }} pages)

You have access to **{{ pageData|length }} semantically-relevant pages** from the company website.
These pages were selected using **hybrid vector search** with comprehensive coverage settings.

**Selection Method**: Hybrid search (80% vector, 20% BM25) with high limit
**‚ö†Ô∏è IMPORTANT: These pages are your PRIMARY SOURCE OF TRUTH.**
- Use the actual content from these pages as evidence
- Cite page URLs when making claims
- The certainty score indicates semantic relevance (higher = more relevant)

{% for page in pageData %}
### Page {{ loop.index }}: {{ page.title or page.url }}
**URL**: {{ page.url }}
**Certainty**: {{ page.certainty }}
**Content Length**: {{ page.content_length }} characters

**Content**:
{{ page.content[:3000] }}{% if page.content|length > 3000 %}... [truncated]{% endif %}

---
{% endfor %}
{% else %}
## ‚ö†Ô∏è NO PAGE CONTENT AVAILABLE

No page content was found for this company/researcher combination via vector search.
Rely on your training knowledge and any other available data sources.
Mark analysisConfidence as "low" or "inferred" if no direct evidence is available.
{% endif %}

## üéØ ANALYSIS TASK

{% if record %}
{% set props = record.properties if record.properties else record %}
{% set display_name = props.get('accountName') or props.get('domain') or 'the company' %}
{% else %}
{% set display_name = 'the company' %}
{% endif %}
Analyze **{{ display_name }}** using the page content provided above.

**Data Source Priority**:
1. **Page Content** (pageData) - PRIMARY SOURCE, cite URLs
2. **SEC Edgar Data** (if available) - For financial metrics
3. **Training Knowledge** - For context and industry norms

## üö® CRITICAL OUTPUT REQUIREMENTS

1. **USE EXACT SCHEMA FIELD NAMES**: You MUST use the exact field names specified in the JSON schema below. Do NOT convert to snake_case or use alternative names.

2. **STRICT SCHEMA COMPLIANCE**: The schema is set to `strict: true` - you MUST only return fields that are defined in the schema properties.

3. **POPULATE ALL SCHEMA FIELDS**: Generate complete analysis for ALL fields shown in the schema. Every field in `properties` must have a value (use `null` only if truly unavailable).

4. **FLAT JSON STRUCTURE**: Return a flat JSON object with all fields at the root level - no nested objects or arrays unless the schema explicitly defines them as array types.

5. **APPROPRIATE DATA TYPES**:
   - Use strings for text fields (e.g., `businessModelLLM`, `companyDescription`)
   - Use arrays for list fields (e.g., `industry` can be an array)
   - Use numbers for metrics
   - Use null only when data is truly unavailable

6. **FIELD NAME EXAMPLES**: If the schema defines `businessModelLLM`, return `businessModelLLM` (NOT `business_model` or `businessModel`).

7. **PARALLEL ARRAYS**: For array fields marked as `parallel_to`, ensure all related arrays have the same length.
   - Example: If `keyExecutives` has 3 items, `executiveRoles` must also have 3 items.
   - Use "Not disclosed" as placeholder for unknown values.

## ‚ö†Ô∏è SCHEMA ENFORCEMENT

The JSON schema below defines the EXACT structure you must return. The schema will be dynamically injected with the complete field definitions for this researcher's collection.

{% if record %}
{% set props = record.properties if record.properties else record %}
{% set display_name = props.get('accountName') or props.get('domain') or 'the company' %}
{% else %}
{% set display_name = 'the company' %}
{% endif %}
Focus your analysis specifically on **{{ display_name }}** using the page content provided.
