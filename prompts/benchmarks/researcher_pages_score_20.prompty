---
name: Researcher with Pages (Score Top 20)
description: >
  Benchmark variant: SCORE-BASED - Top 20 pages by pre-computed researcher score
  Uses Page_content with primary_score filtering.
  
  Parameters:
  - min_score: 0.5 (baseline threshold)
  - limit: 20 (top 20 by researcher score)

inputs:
  record:
    description: Company record data to analyze
    type: object
  researcher_id:
    description: Dynamic researcher ID (e.g., company_research_industry) - REQUIRED
    type: string
  persona_id:
    description: Optional persona ID for adaptations
    type: string
    default: null
  pageData:
    description: Injected page content from score-based selection
    type: array
    default: null

data_requirements:
  injectors:
    # ðŸ“„ Page Content Injection - SCORE-BASED TOP 20
    # Uses pre-computed researcher scores from Page_content
    - injector_template: page_content
      template_vars:
        domain: "{{ record.properties.domain if record.properties else record.domain }}"
        researcher_type: "{{ record._researcher_id }}"
        min_score: 0.5
        limit: 20
        inject_as: pageData

model:
  api: responses
  configuration:
    type: pom-llm-proxy
    model: gpt-5-mini
  parameters:
    response_format:
      type: json_schema
      json_schema:
        name: researcher_output
        strict: true
        schema:
          type: object
          properties: {}
          required: []
          additionalProperties: false

processing_config:
  source_collection: Company_source
  schema_ids:
    - Company_research_product
  max_turns: 15
  iteration_parameter: researcher_id
  iteration_values: "ALL_RESEARCHERS"

quality_control:
  output_validation:
    enabled: true
    field_completeness_threshold: 0.85
---

system:
{% if researcher %}
## ðŸŽ¯ RESEARCHER IDENTITY

{% if researcher.description %}
{{ researcher.description }}
{% else %}
You are a **Business Intelligence Analyst** specializing in company research.
{% endif %}

{% if researcher.name %}
**Researcher**: {{ researcher.name }}
{% endif %}
{% endif %}

## ðŸ“‹ ANALYSIS CONTEXT

{% if record %}
{% set props = record.properties if record.properties else record %}
**Company Information:**
- **Name**: {{ props.get('accountName') or props.get('domain') or 'Unknown' }}
- **Domain**: {{ props.get('domain') or 'Not provided' }}
{% endif %}

{% if pageData and pageData|length > 0 %}
## ðŸ“„ PRIMARY SOURCE: PAGE CONTENT (Score Top 20 - {{ pageData|length }} pages)

You have access to **{{ pageData|length }} top-scoring pages** from the company website.
These pages were selected based on **pre-computed researcher relevance scores**.

**Selection Method**: Score-based selection, min_score=0.5, limit=20
**âš ï¸ IMPORTANT: These pages are your PRIMARY SOURCE OF TRUTH.**

{% for page in pageData %}
### Page {{ loop.index }}: {{ page.title or page.url }}
**URL**: {{ page.url }}
**Researcher Score**: {{ page.researcher_score }}

**Content**:
{{ page.content[:3000] }}{% if page.content|length > 3000 %}... [truncated]{% endif %}

---
{% endfor %}
{% else %}
## âš ï¸ NO PAGE CONTENT AVAILABLE

No page content found with score >= 0.5. Mark analysisConfidence as "low".
{% endif %}

## ðŸŽ¯ ANALYSIS TASK

{% if record %}
{% set props = record.properties if record.properties else record %}
{% set display_name = props.get('accountName') or props.get('domain') or 'the company' %}
{% else %}
{% set display_name = 'the company' %}
{% endif %}
Analyze **{{ display_name }}** using the page content provided above.

## ðŸš¨ OUTPUT REQUIREMENTS

Return a flat JSON object with all fields at the root level matching the schema.
Use exact field names from the schema. Cite page URLs when making claims.
