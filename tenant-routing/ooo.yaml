# =============================================================================
# OOO (OUT OF OFFICE) MODE TENANT ROUTING
# =============================================================================
# Mode: Full remote access via Cloudflare tunnels
# Use case: Remote development, unattended Spark operations
# =============================================================================

mode: ooo
version: "1.1"
description: "OOO mode - Full remote access via Cloudflare tunnels"

defaults:
  weaviate_target: spark
  cloud_enabled: true
  spark_enabled: true

tunnel_config:
  spark_cloudflare_tunnel:
    name: spark-services
    id: "${CLOUDFLARE_TUNNEL_SPARK_ID}"
    services:
      ollama: "${SPARK_OLLAMA_TUNNEL_URL}"
      weaviate: "${SPARK_WEAVIATE_TUNNEL_URL}"
      transformers: "${SPARK_TRANSFORMERS_TUNNEL_URL}"
  
  mac_cloudflare_tunnel:
    name: "${CLOUDFLARE_TUNNEL_MAC}"
    hostname: "${LLM_PROXY_EXTERNAL_URL}"
    note: "Only needed for external device access to Mac LLM Proxy"

weaviate_instances:
  spark:
    url: "${SPARK_WEAVIATE_TUNNEL_URL}"
    description: "Spark Weaviate via Cloudflare tunnel"
  
  cloud:
    url: "${WEAVIATE_CLOUD_URL}"
    api_key_env: WEAVIATE_CLOUD_KEY
    description: "Cloud Weaviate - Production data"
  
  mac:
    url: "http://mac-weaviate:8080"
    description: "Mac Weaviate - Local development/testing"

tenants:
  prismatic:
    weaviate_target: cloud
    description: "Production tenant - routes to Cloud Weaviate"
    collections:
      Research_*: cloud
      Opportunity: cloud
      # OOO mode uses Mac for page processing (safer than tunneling large data)
      Domain: mac
      Page_facts: mac
      Page_intelligence: cloud
  
  test_db:
    weaviate_target: mac
    description: "Test tenant - always routes to local mac-weaviate"
  
  demo:
    weaviate_target: mac
    description: "Demo tenant - local only"

architecture:
  external_access: "Cursor/Apps → ${LLM_PROXY_EXTERNAL_URL} → Cloudflare → Mac:4000 (pom-llm-proxy)"
  spark_access: "Apps → ${SPARK_OLLAMA_TUNNEL_URL} → Cloudflare → Spark (Ollama, Weaviate, Transformers)"
  security: "All access via Cloudflare Zero Trust, no direct port exposure"

notes:
  mode: "Full Mac stack running (Weaviate, Ollama, Transformers, Redis)"
  cloud: "Cloud Weaviate accessible via API (if internet available)"
  spark: "Full Spark access via Cloudflare tunnel (no SSH needed)"
  tunnel: "Two Cloudflare tunnels: Mac (llm.pomothy.io) + Spark (spark-*.pomothy.io)"
