id: entity_scope_registry
version: 1
description: >
  Schema-driven entity scoping for chat RAG. Defines how to resolve entities
  and map them to collection filters. Supports composite scoping (e.g. segment + category)
  and relationship expansion for next-turn performance.

entity_types:
  domain_entity:
    label: Domain Entity
    primary_collection: Domain

    lookup:
      collection: Domain
      limit: 5
      query_properties:
        - entityName
        - domain
        - url
        - title
        - description
      return_properties:
        - entityName
        - domain
        - url
        - entityId
        - description
      filters:
        - field: ready_for_review
          operator: equal
          value: true

    scope:
      collections:
        Domain:
          combine: or
          filters:
            - field: domain
              operator: contains_any
              from_entity: domain_scope
            - field: entityId
              operator: equal
              from_entity: entity_id
            - field: entityName
              operator: equal
              from_entity: entity_name
        Page_facts:
          combine: or
          filters:
            - field: domain
              operator: contains_any
              from_entity: domain_scope
        Knowledge_base:
          combine: or
          filters:
            - field: domain
              operator: contains_any
              from_entity: domain_scope
        Research_*:
          combine: or
          filters:
            - field: domain
              operator: contains_any
              from_entity: domain_scope
            - field: entityId
              operator: equal
              from_entity: entity_id

    relationships:
      fields:
        - competitorOf
        - customerOf
        - partnerOf
      max_first_hop: 50
      max_second_hop: 200

  market_segment:
    label: Market Segment
    primary_collection: Research_industry

    lookup:
      collection: Research_industry
      limit: 8
      target_vector: industrySegmentVector  # Multi-vector collection requires target vector
      query_properties:
        - industrySegmentCat
        - industrySegmentLLM
        - sector
        - industry
        - businessModelCat
        - businessModelLLM
        - naicsDescription
      return_properties:
        - industrySegmentCat
        - industrySegmentLLM
        - sector
        - industry
        - businessModelCat
        - entityName
        - entityDescription

    scope:
      collections:
        Research_industry:
          combine: or
          filters:
            - field: industrySegmentCat
              operator: contains_any
              from_entity: industry_segment
            - field: industry
              operator: contains_any
              from_entity: industry_category
            - field: businessModelCat
              operator: contains_any
              from_entity: business_model
        # Other Research collections have domain field for scoping
        Research_*:
          combine: or
          filters:
            - field: domain
              operator: contains_any
              from_entity: domain_scope
        Domain:
          combine: or
          filters:
            - field: domain
              operator: contains_any
              from_entity: domain_scope
        Page_facts:
          combine: or
          filters:
            - field: domain
              operator: contains_any
              from_entity: domain_scope
        Knowledge_base:
          combine: or
          filters:
            - field: domain
              operator: contains_any
              from_entity: domain_scope

    # Note: Research_industry doesn't have domain field
    # domain_sampling must use a different approach for market segments
