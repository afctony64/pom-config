id: entity_scope_registry
version: 2
description: >
  Schema-driven entity scoping for chat RAG. Defines how to resolve entities
  and map them to collection filters using Domain + Research_* knowledge base.
  Supports composite scoping and relationship expansion for next-turn performance.

entity_types:
  domain_entity:
    label: Domain Entity
    primary_collection: Domain

    lookup:
      collection: Domain
      limit: 5
      query_properties:
        - domain
        - entityName
        - description
        - title
      return_properties:
        - domain
        - entityName
        - description
        - entityType
        - headquarters
        - foundedYear
        - spawnedFrom
        - spawnedBy
        - seed

    scope:
      collections:
        Domain:
          combine: or
          filters:
            - field: domain
              operator: equal
              from_entity: domain
        Research_*:
          combine: or
          filters:
            - field: domain
              operator: contains_any
              from_entity: domain_scope

    relationships:
      fields:
        - competitorOf
        - customerOf
        - partnerOf
      max_first_hop: 50
      max_second_hop: 200

  market_segment:
    label: Market Segment
    primary_collection: Domain

    lookup:
      collection: Domain
      limit: 8
      query_properties:
        - entityName
        - description
        - title
      return_properties:
        - domain
        - entityName
        - description
        - entityType
        - headquarters
        - spawnedFrom

    scope:
      collections:
        Domain:
          combine: or
          filters:
            - field: domain
              operator: contains_any
              from_entity: domain_scope
        Research_*:
          combine: or
          filters:
            - field: domain
              operator: contains_any
              from_entity: domain_scope
