id: entity_scope_registry
version: 1
description: >
  Schema-driven entity scoping for chat RAG. Defines how to resolve entities
  and map them to collection filters. Supports composite scoping (e.g. segment + category)
  and relationship expansion for next-turn performance.

entity_types:
  domain_entity:
    label: Domain Entity
    primary_collection: Page_facts  # Use Page_facts which has all the data

    lookup:
      collection: Page_facts
      limit: 5
      query_properties:
        - domain
        - title
        - description
        - content
      return_properties:
        - domain
        - title
        - description
        - url
        - page_type
      filters:
        - field: is_primary_chunk
          operator: equal
          value: true

    scope:
      collections:
        Page_facts:
          combine: or
          filters:
            - field: domain
              operator: equal
              from_entity: domain
        Knowledge_base:
          combine: or
          filters:
            - field: domain
              operator: contains_any
              from_entity: domain_scope
        # Research collections may have domain field for scoping
        Research_*:
          combine: or
          filters:
            - field: domain
              operator: contains_any
              from_entity: domain_scope

    relationships:
      fields:
        - competitorOf
        - customerOf
        - partnerOf
      max_first_hop: 50
      max_second_hop: 200

  market_segment:
    label: Market Segment
    primary_collection: Page_facts  # Use Page_facts which has all data in prismatic

    lookup:
      collection: Page_facts
      limit: 8
      query_properties:
        - title
        - description
        - content
        - keywords
      return_properties:
        - domain
        - title
        - description
        - keywords
        - page_type
      filters:
        - field: is_primary_chunk
          operator: equal
          value: true

    scope:
      collections:
        Page_facts:
          combine: or
          filters:
            - field: keywords
              operator: contains_any
              from_entity: market_keywords
            - field: domain
              operator: contains_any
              from_entity: domain_scope
        Knowledge_base:
          combine: or
          filters:
            - field: domain
              operator: contains_any
              from_entity: domain_scope
