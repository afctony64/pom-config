id: customer
type: researcher_ai
researcher_type: customer
# Researcher AI Configuration: Customer Intelligence
# Links to pom-core collection schema for data structure

collection_schema_id: Research_customer
name: Research Customer

researcher_identity:
  title: Customer Intelligence Analyst
  mission: Extract and analyze customer profile data, testimonials, and relationship signals
  ecosystem_role: Customer-focused researcher delivering structured customer intelligence
  core_competencies:
  - 'Customer Segmentation: Profile analysis, engagement levels, satisfaction ratings'
  - 'Use Case Analysis: Customer application patterns, value tiers, target markets'
  - 'Relationship Management: Engagement tracking, success metrics, testimonial analysis'
  - 'Case Study Research: Customer stories, implementation patterns, success indicators'
  - 'Industry Analysis: Customer industry identification, vertical segmentation, NAICS classification'

# Semantic search queries for page selection (page_facts_vector injector)
# Issue #437: Multiple queries for comprehensive Page_facts coverage
# NOTE: Queries phrased as ANSWER DESCRIPTIONS, not questions
# Questions match question-like patterns (privacy policy "How we use...")
# Answer descriptions match actual customer content
search_queries:
  - "customer logo case study testimonial success story"
  - "enterprise SMB mid-market Fortune 500 customers"
  - "results achieved ROI implementation outcome"
  - "trusted by used by customers include"

# BM25 keyword queries - used by page_facts_vector injector (supplements vector)
keyword_queries:
  - "case study"
  - "case studies"
  - "testimonial"
  - "success story"
  - "trusted by"

# URL boost patterns - used by page_facts_vector injector
url_boost_patterns:
  - "/customers"
  - "/customer"
  - "/case-study"
  - "/case-studies"
  - "/success-stories"
  - "/testimonials"

# Focus areas for this researcher (prompt guidance, not used by injector)
focus_areas:
  - Customer names and logos (for keyCustomers array)
  - Case study summaries and outcomes (parallel to keyCustomers)
  - Customer industries and segments (Enterprise, SMB, mid-market)
  - Use cases and implementation patterns
  - Testimonials and customer quotes

# Fact types to extract from source content
# Used by ContextExecutor for fact-type prioritization when preparing context.
fact_types:
  - customer_name
  - case_study
  - use_case
  - customer_industry
  - customer_segment
  - testimonial
  - implementation_pattern

# Anti-patterns to avoid (guides LLM away from common mistakes)
avoid:
  - Confusing technology partners with customers
  - Assuming customer segments without evidence from sources
  - Including outdated case studies as if they are current
  - Listing prospects or leads as existing customers
  - Using logos without confirming customer relationship
  - Inventing customer outcomes not stated in testimonials

# Tools available for this researcher
# NOTE: brave_search is rarely needed for customer EXTRACTION (names are on site)
# but parallel_array_enricher uses brave_search for domain resolution
tools:
  - brave_search  # Enabled for enricher domain resolution

tool_guidance:
  brave_search:
    priority: low
    max_calls: 2  # LIMIT: Mainly used by enricher for domain resolution
    when_to_use: |
      ðŸ” SEARCH ONLY IF page content lacks customer examples

      **SEARCH (RARELY NEEDED):**
      â†’ "{company} customer case study"

      âš ï¸ PREFER PAGE CONTENT - company sites SHOWCASE customers!

      **NOTE:** parallel_array_enricher will use brave_search separately
      to find customer domains (e.g., "Yoti company official website").

    recommended_searches:
      primary: "{company_name} customer case study success story"

citation_note: "No inline URLs in field values; put sources in CIT/evidence fields."

# Entity spawn configuration
# Spawn fields are auto-detected from schema via sets: [spawn] (pom-core#295)
# - Source field: text[] with spawn set and no parallel_to
# - Domain field: text[] with spawn set and parallel_to, name contains "domain"
# - Context fields: Other fields with spawn set and parallel_to
entity_spawn:
  enabled: true  # Schema defines fields via sets: [spawn]

# Parallel array enrichment configuration
# Uses generic parallel_array_enricher.prompty to fill post fields via web search
# IMPORTANT: Customer companies are often small/unknown - need explicit search guidance
# The domain_candidates injector in enricher.prompty does the actual domain search
parallel_array_enrichment:
  enabled: true
  anchor_field: keyCustomers
  context_fields:
    - domain                    # Source entity domain for disambiguation
    - entityName                # Tenant name helps disambiguate customer searches
  # enrich_fields: Auto-detected from schema via sets: [post]
  # NOTE: Search query template adds tenant context to help find small/unknown customers
  # Domain resolution: "Yoti B2B SaaS customer company official website"
  # Evidence/details: "{subject} {domain} customer case study use case industry segment size evidence"
  search_query_template: >
    {subject} official website

# Prompt chain: prompt types executed in list order after the main researcher prompt.
# Each link receives execution artifacts from the main prompt and prior links.
# This is a chain definition â€” the list order defines implicit dependencies.
post_execution_tools:
  - parallel_array_enricher  # Enrich array_enricher fields (customerDomain + evidence via search)
  - entity_spawn             # Creates Domain records for customers
  - enum_cat                 # Classify cat_classifier fields
  - vec_cat                  # Classify vec_classifier fields
  - pdf_report_saver         # Generates report
