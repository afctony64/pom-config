id: domain
type: researcher_ai
researcher_type: domain
# Domain Researcher: Updates Domain records with identity fields
# SPECIAL CASE: Targets Domain collection, not Research_*
# Requires pom-core issue #557 for full support

collection_schema_id: Domain
name: Domain Identity

# Special flags for Domain-targeting researcher
update_mode: true  # UPDATE existing records, don't CREATE new
confidence_based_update: true  # Only overwrite if new data has higher confidence
execution_order: 100  # Runs LAST after all other researchers

# DOCUMENTATION: Fields this researcher populates on Domain
# (Actual field restrictions come from the prompt schema)
output_fields:
  - entityName      # Official company name
  - country         # ISO 2-letter code
  - foundedYear     # Year founded (int)
  - headquarters    # Full location string
  - email           # Primary contact email
  - phone           # Primary phone number
  - address         # Street address
  - city            # City
  - region          # State/Province
  - postalCode      # ZIP/Postal code

# PROTECTED: Never touch these fields regardless of output
protected_fields:
  - domain
  - url
  - tenantId
  - uuid
  - createdAt
  - updatedAt
  - enrichmentStatus
  - enrichmentError
  - lastEnrichedAt

researcher_identity:
  title: Entity Identity Analyst
  mission: Extract and validate entity identity from About, Contact, and legal pages
  ecosystem_role: Identity-focused researcher that runs last to backfill empty Domain fields
  core_competencies:
  - 'Entity Naming: Official company name extraction from structured data, copyright, About pages'
  - 'Location Intelligence: Headquarters, country of operation from Contact/About pages'
  - 'Contact Extraction: General contact email and address'
  - 'Source Validation: Respect existing enricher data, only fill gaps with higher confidence'

# Semantic search query for page selection
# Focus on identity-specific pages
search_query: >
  Who is this company? What is the company name and where are they located?
  About us, company information, contact details, headquarters location.

# Minimal tool usage - prioritize page content
tools:
  - brave_search

tool_guidance:
  brave_search:
    priority: low
    max_calls: 1
    when_to_use: |
      MINIMAL SEARCH (MAX 1 CALL):
      
      PRIORITIZE PAGE CONTENT! Only search if:
      - Company name unclear from About page
      - Headquarters/country not found anywhere on site
      
      Search query if needed:
      "{domain} company name headquarters location"
      
    recommended_searches:
      primary: "{domain} company headquarters founded"

  structured_output:
    priority: critical
    usage_instructions: |
      OUTPUT FORMAT - IDENTITY & CONTACT FIELDS:

      IDENTITY FIELDS:
      ────────────────
      entityName:
        Extract the official company name (NOT page title, NOT tagline)
        Sources (priority order):
        1. JSON-LD: "@type": "Organization", "name": "..."
        2. OpenGraph: <meta property="og:site_name">
        3. Copyright footer: "© 2024 Acme Corporation"
        4. About page: "Acme Corporation is a leading..."
        5. Legal/Terms: "Acme Corporation, Inc. ('Company')"
        NEVER use: "Home", taglines, domain names

      foundedYear:
        Integer year (e.g., 2015)
        Extract from About page, company history
        Use null if not found

      LOCATION FIELDS:
      ────────────────
      headquarters:
        Full location string: "San Francisco, CA, USA"
        Extract from Contact page, About page, footer

      country:
        ISO 2-letter code (US, UK, CA, AU, DE, etc.)
        Extract from headquarters, contact page, or legal/terms

      address:
        Street address only (e.g., "123 Main Street, Suite 100")

      city:
        City name (e.g., "San Francisco")

      region:
        State/Province (e.g., "CA" or "California")

      postalCode:
        ZIP/Postal code (e.g., "94105")

      CONTACT FIELDS:
      ────────────────
      email:
        General contact email (prefer info@, contact@, hello@)
        Avoid: sales@, support@, careers@

      phone:
        Primary phone number in standard format
        Extract from Contact page, footer

      CONFIDENCE RULE:
      Only output fields where you have HIGH confidence.
      Empty/null is better than guessing.
