#!/usr/bin/env bash
set -euo pipefail

echo "[pom-config] post-merge hook: repository updated."

if git diff --name-only HEAD@{1}..HEAD | grep -E '\.ya?ml$|\.prompty$|\.env$|^OWNERSHIP\.yaml$' >/dev/null; then
  echo "[pom-config] Detected config or ownership changes; running validations."
  if command -v python3 >/dev/null 2>&1; then
    python3 scripts/validate_all_configs.py
    python3 scripts/validate-ownership.py
  else
    echo "[pom-config] python3 not found; please run:"
    echo "  python3 scripts/validate_all_configs.py"
    echo "  python3 scripts/validate-ownership.py"
  fi
else
  echo "[pom-config] No config/ownership changes detected."
fi
