type: core
class: Domain
version: 9.4
group: url
weaviate_instance: cloud
description: |
  Domain collection - THE UNIVERSAL ENTITY COLLECTION.
  
  KEY CONCEPT: The Entity IS the Domain record.
  - URL is the entity's digital signature (identity)
  - Domain represents BOTH digital and physical presence
  - Could be: company, destination, recipe, film, book
  - Tenant isolation defines whose research it is
  - TenantGroup defines which researchers to run
  - Everything else is DISCOVERED by enrichers and researchers
  
  FLOW:
  1. URL seed → Domain record created (entity exists)
  2. Enrichers discover: content, social_accounts, sitemaps, etc.
  3. TenantGroup.researchers analyze → Research_* collections
  4. Research records reference back to this Domain
  
  SCHEMA v9.4 CHANGES:
  - Added page_facts_last_run_status for last Page Facts outcome
  
  SCHEMA v9.3 CHANGES:
  - Added typed relationship references: competitorOf, customerOf, partnerOf
  - These enable market traversal queries (e.g., "who are X's competitors?")
  - A domain can have multiple relationships across different companies
  - Deprecated spawnedFromRef (Phase 2 will migrate and remove)
  
  SCHEMA v9.2 CHANGES:
  - Added 'prompt' set for LLM-extractable information fields
  - Added 'system' set for infrastructure/pipeline fields (protected from LLM)
  - Prompt fields: entityName, description, foundedYear, headquarters, 
    phone, email, address, city, region, country, postalCode, coordinates
  - System fields: sitemaps, homepage stats, security, social, technical, 
    processing flags, enricher results, spawn fields
  
  SCHEMA v9.0 CHANGES:
  - Added physical presence fields (phone, email, address, etc.)
  - Consolidated social fields (15 → 10)
  - Removed 52 unused legacy fields
  - Simplified references

vectorConfig:
  default:
    text2vec-weaviate:
      model: sentence-transformers/all-MiniLM-L6-v2
      vectorizeClassName: true
      sourceProperties:
      - title
      - description
      - content
multiTenancyConfig:
  enabled: true
  autoTenantCreation: true
  autoTenantActivation: true
invertedIndexConfig:
  indexNullState: true
  indexTimestamps: false
  indexPropertyLength: false
  cleanupIntervalSeconds: 60
  bm25:
    b: 0.75
    k1: 1.2

properties:
# ============================================================================
# IDENTITY (5 fields)
# ============================================================================
- name: url
  dataType:
  - text
  description: Primary URL - THE ENTITY'S DIGITAL SIGNATURE (unique identity)
  indexFilterable: true
  tokenization: field
  indexSearchable: true
  indexInverted: true
  sets:
  - standard
  - status_update
  tags:
  - identity
  - web
  - research  # FIX #457: Include in research data card traversals

- name: domain
  dataType:
  - text
  description: Domain extracted from URL
  indexFilterable: true
  tokenization: field
  indexSearchable: true
  sets:
  - standard
  - status_update
  tags:
  - research  # FIX #457: Include in research data card traversals
  - categorical
  - web

- name: entityType
  dataType:
  - text
  description: Entity type derived from TenantGroup (Company, Destination, Recipe, Film, Book)
  indexFilterable: true
  tokenization: field
  sets:
  - standard
  tags:
  - identity
  - categorical
  - research  # FIX #457: Include in research data card traversals

- name: entityId
  dataType:
  - text
  description: External identifier from source system (e.g., Salesforce accountId, CRM ID). Enables tracking tenant-specific entity IDs.
  indexFilterable: true
  tokenization: field
  sets:
  - standard
  - system
  tags:
  - identity
  - external

- name: title
  dataType:
  - text
  description: Page title extracted from URL snapshot
  indexSearchable: true
  tokenization: word
  sets:
  - standard
  - system
  tags:
  - content
  - metadata

- name: entityName
  dataType:
  - text
  description: Human-readable entity name (e.g., "Paragon" instead of "useparagon.com")
  label: Entity Name
  indexSearchable: true
  tokenization: word
  sets:
  - standard
  - prompt
  tags:
  - identity
  - metadata
  - research

- name: description
  dataType:
  - text
  description: Entity description extracted by domain researcher
  indexSearchable: true
  tokenization: word
  sets:
  - standard
  - prompt
  tags:
  - content
  - metadata
  - research

- name: foundedYear
  dataType:
  - int
  description: Year the entity was founded/established
  indexFilterable: true
  sets:
  - extended
  - prompt
  tags:
  - identity
  - metadata

- name: headquarters
  dataType:
  - text
  description: Headquarters location (e.g., "San Francisco, CA, USA")
  indexSearchable: true
  tokenization: word
  sets:
  - extended
  - prompt
  tags:
  - identity
  - location

# ============================================================================
# PHYSICAL PRESENCE (8 fields) - PROMPT FIELDS (domain researcher updates these)
# ============================================================================
- name: phone
  dataType:
  - text
  description: Primary phone number discovered from website
  indexFilterable: true
  tokenization: field
  sets:
  - extended
  - prompt
  tags:
  - contact
  - physical

- name: email
  dataType:
  - text
  description: Primary contact email discovered from website
  indexFilterable: true
  tokenization: field
  sets:
  - extended
  - prompt
  tags:
  - contact
  - physical

- name: address
  dataType:
  - text
  description: Full street address
  indexSearchable: true
  tokenization: word
  sets:
  - extended
  - prompt
  tags:
  - location
  - physical

- name: city
  dataType:
  - text
  description: City name
  indexFilterable: true
  tokenization: field
  sets:
  - extended
  - prompt
  tags:
  - location
  - physical

- name: region
  dataType:
  - text
  description: State/Province/Region
  indexFilterable: true
  tokenization: field
  sets:
  - extended
  - prompt
  tags:
  - location
  - physical

- name: country
  dataType:
  - text
  description: Country name or ISO code
  indexFilterable: true
  tokenization: field
  sets:
  - extended
  - prompt
  tags:
  - location
  - physical

- name: postalCode
  dataType:
  - text
  description: Postal/ZIP code
  indexFilterable: true
  tokenization: field
  sets:
  - extended
  - prompt
  tags:
  - location
  - physical

- name: coordinates
  dataType:
  - geoCoordinates
  description: Geographic coordinates (latitude, longitude)
  sets:
  - extended
  - prompt
  tags:
  - location
  - physical

# ============================================================================
# CONTENT QUALITY (5 fields) - SYSTEM FIELDS (enricher-managed)
# ============================================================================
- name: content
  dataType:
  - text
  description: Page content extracted from URL snapshot
  indexSearchable: true
  tokenization: word
  sets:
  - extended
  - system
  tags:
  - content
  - enriched

- name: content_quality_score
  dataType:
  - number
  description: Content quality score (0-1) from dynamic_html enricher
  indexFilterable: true
  sets:
  - extended
  - system
  tags:
  - metrics
  - quality

- name: site_readable
  dataType:
  - boolean
  description: Whether the site content was successfully readable
  indexFilterable: true
  sets:
  - extended
  - system
  tags:
  - accessibility

- name: seo_maturity
  dataType:
  - text
  description: SEO sophistication level from robots_txt analysis (basic/intermediate/advanced/unknown)
  indexFilterable: true
  tokenization: field
  sets:
  - extended
  - system
  tags:
  - seo
  - maturity

- name: crawl_openness
  dataType:
  - text
  description: Crawling accessibility from robots_txt analysis (open/restricted/blocked/unknown)
  indexFilterable: true
  tokenization: field
  sets:
  - extended
  - system
  tags:
  - crawling
  - accessibility

# ============================================================================
# SOCIAL PRESENCE (10 fields - consolidated from 15) - SYSTEM FIELDS (enricher-managed)
# ============================================================================
- name: social_accounts
  dataType:
  - text
  description: JSON string of discovered social media accounts by platform
  indexSearchable: true
  sets:
  - standard
  - system
  tags:
  - accounts
  - social
  - digital

- name: social_platforms
  dataType:
  - text[]
  description: Array of social media platforms detected
  indexFilterable: true
  indexSearchable: true
  sets:
  - extended
  - system
  tags:
  - discovery
  - platforms
  - social
  - digital

- name: social_accounts_found
  dataType:
  - int
  description: Number of social media accounts discovered
  indexFilterable: true
  sets:
  - extended
  - system
  tags:
  - accounts
  - discovery
  - social
  - digital

- name: social_engagement_score
  dataType:
  - int
  description: Social engagement score from deep analysis (0-100)
  indexFilterable: true
  sets:
  - extended
  - system
  tags:
  - engagement
  - metrics
  - social
  - digital

- name: social_presence_tier
  dataType:
  - text
  description: Social presence tier (Strong/Good/Basic/Minimal) from social_snapshot enricher
  indexFilterable: true
  tokenization: field
  sets:
  - extended
  - system
  tags:
  - categorical
  - social
  - tier
  - digital

- name: has_social_auth
  dataType:
  - boolean
  description: Whether site has social authentication options
  indexFilterable: true
  sets:
  - extended
  - system
  tags:
  - authentication
  - features
  - social
  - digital

- name: has_social_sharing
  dataType:
  - boolean
  description: Whether site has social sharing features
  indexFilterable: true
  sets:
  - extended
  - system
  tags:
  - features
  - sharing
  - social
  - digital

- name: has_community_features
  dataType:
  - boolean
  description: Whether site has community/engagement features
  indexFilterable: true
  sets:
  - extended
  - system
  tags:
  - community
  - features
  - social
  - digital

- name: social_authentication
  dataType:
  - text[]
  description: Array of social authentication methods detected
  indexSearchable: true
  sets:
  - standard
  - system
  tags:
  - authentication
  - social
  - digital

- name: social_sharing_features
  dataType:
  - text[]
  description: Array of social sharing features detected
  indexSearchable: true
  sets:
  - standard
  - system
  tags:
  - sharing
  - social
  - digital

# ============================================================================
# SECURITY PROFILE (8 fields) - SYSTEM FIELDS (enricher-managed)
# ============================================================================
- name: is_secure
  dataType:
  - boolean
  description: Overall security assessment from http_security_headers enricher
  indexFilterable: true
  sets:
  - extended
  - system
  tags:
  - security

- name: security_grade
  dataType:
  - text
  description: Security grade (A/B/C/D/F) from http_security_headers enricher
  indexFilterable: true
  tokenization: field
  sets:
  - extended
  - system
  tags:
  - security
  - grade

- name: security_score
  dataType:
  - int
  description: Security score (0-100) from http_security_headers enricher
  indexFilterable: true
  sets:
  - extended
  - system
  tags:
  - metrics
  - security

- name: has_hsts
  dataType:
  - boolean
  description: Has HTTP Strict Transport Security header
  indexFilterable: true
  sets:
  - extended
  - system
  tags:
  - security
  - headers

- name: has_csp
  dataType:
  - boolean
  description: Has Content Security Policy header
  indexFilterable: true
  sets:
  - extended
  - system
  tags:
  - security
  - headers

- name: has_frame_options
  dataType:
  - boolean
  description: Has X-Frame-Options header
  indexFilterable: true
  sets:
  - extended
  - system
  tags:
  - security
  - headers

- name: has_content_type_options
  dataType:
  - boolean
  description: Has X-Content-Type-Options header
  indexFilterable: true
  sets:
  - extended
  - system
  tags:
  - security
  - headers

- name: bot_protected
  dataType:
  - boolean
  description: Whether site has bot protection detected
  indexFilterable: true
  sets:
  - extended
  - system
  tags:
  - security
  - protection

# ============================================================================
# TECHNICAL PROFILE (6 fields) - SYSTEM FIELDS (enricher-managed)
# ============================================================================
- name: requires_browser
  dataType:
  - boolean
  description: Whether this site requires browser/Playwright for page scraping (JS-rendered or bot-protected)
  indexFilterable: true
  sets:
  - extended
  - status_update
  - system
  tags:
  - processing
  - browser

- name: captcha_detected
  dataType:
  - boolean
  description: Whether CAPTCHA/bot protection was detected during enrichment
  indexFilterable: true
  sets:
  - extended
  - system
  tags:
  - processing
  - browser

- name: has_ipv4
  dataType:
  - boolean
  description: Has IPv4 addresses from dns_fingerprint enricher
  indexFilterable: true
  sets:
  - extended
  - system
  tags:
  - dns
  - network

- name: has_ipv6
  dataType:
  - boolean
  description: Has IPv6 addresses from dns_fingerprint enricher
  indexFilterable: true
  sets:
  - extended
  - system
  tags:
  - dns
  - network

- name: business_technology
  dataType:
  - text
  description: Technology stack indicators from robots_txt analysis
  indexSearchable: true
  tokenization: word
  sets:
  - extended
  - system
  tags:
  - technology
  - digital

- name: robots_rules_count
  dataType:
  - number
  description: Number of rules found in robots.txt
  indexFilterable: true
  sets:
  - extended
  - system
  tags:
  - robots
  - technical

# ============================================================================
# URL DISCOVERY (kept per user requirement) - SYSTEM FIELDS (enricher-managed)
# ============================================================================
- name: all_sitemap_urls
  dataType:
  - text[]
  description: Complete list of all sitemap URLs discovered
  indexSearchable: true
  sets:
  - url_discovery
  - system
  tags:
  - sitemap
  - urls

- name: discovered_sitemaps
  dataType:
  - text[]
  description: XML sitemap URLs discovered by sitemap_discovery enricher
  indexSearchable: true
  sets:
  - url_discovery
  - system
  tags:
  - sitemap
  - urls

- name: robots_sitemap_urls
  dataType:
  - text[]
  description: Sitemap URLs found in robots.txt
  indexFilterable: false
  sets:
  - url_discovery
  - system
  tags:
  - sitemap
  - urls

- name: homepage_urls_discovered
  dataType:
  - text[]
  description: URLs discovered from homepage parsing by homepage_parser enricher
  indexSearchable: true
  sets:
  - url_discovery
  - system
  tags:
  - homepage
  - urls

- name: primary_sitemap
  dataType:
  - text
  description: Primary sitemap URL for URL discovery
  indexFilterable: true
  tokenization: field
  sets:
  - url_discovery
  - system
  tags:
  - sitemap
  - primary

- name: sitemap_discovery_method
  dataType:
  - text
  description: Method used to discover sitemaps (robots_txt/well_known/dns)
  indexFilterable: true
  tokenization: field
  sets:
  - extended
  - system
  tags:
  - discovery
  - method

- name: total_sitemaps_discovered
  dataType:
  - int
  description: Total number of sitemaps discovered
  indexFilterable: true
  sets:
  - extended
  - system
  tags:
  - sitemap
  - count

# ============================================================================
# HOMEPAGE DISCOVERY STATS - SYSTEM FIELDS (enricher-managed)
# ============================================================================
- name: homepage_total_links
  dataType:
  - int
  description: Total number of links found on homepage
  indexFilterable: true
  sets:
  - extended
  - system
  tags:
  - homepage
  - count

- name: homepage_valid_content_urls
  dataType:
  - int
  description: Count of valid content URLs extracted from homepage
  indexFilterable: true
  sets:
  - extended
  - system
  tags:
  - homepage
  - count

- name: homepage_discovery_method
  dataType:
  - text
  description: Method used for homepage discovery (direct/redirect)
  indexFilterable: true
  tokenization: field
  sets:
  - extended
  - system
  tags:
  - homepage
  - method

- name: homepage_has_navigation
  dataType:
  - boolean
  description: Whether homepage has navigation menu
  indexFilterable: true
  sets:
  - extended
  - system
  tags:
  - homepage
  - structure

- name: homepage_has_footer
  dataType:
  - boolean
  description: Whether homepage has footer section
  indexFilterable: true
  sets:
  - extended
  - system
  tags:
  - homepage
  - structure

- name: homepage_has_main_content
  dataType:
  - boolean
  description: Whether homepage has main content area
  indexFilterable: true
  sets:
  - extended
  - system
  tags:
  - homepage
  - structure

- name: homepage_social_links
  dataType:
  - int
  description: Count of social media links found on homepage
  indexFilterable: true
  sets:
  - extended
  - system
  tags:
  - homepage
  - social

- name: homepage_contact_indicators
  dataType:
  - int
  description: Count of contact indicators found on homepage
  indexFilterable: true
  sets:
  - extended
  - system
  tags:
  - homepage
  - contact

# ============================================================================
# SPAWN/SEED FIELDS (4 fields) - SYSTEM FIELDS (entity_spawn tool managed)
# ============================================================================
- name: seed
  dataType:
  - boolean
  description: Whether this domain was spawned and needs enrichment
  indexFilterable: true
  sets:
  - extended
  - system
  tags:
  - spawn
  - processing

- name: spawnedFrom
  dataType:
  - text
  description: Domain that spawned this record (e.g., source domain for competitor)
  indexFilterable: true
  tokenization: field
  sets:
  - extended
  - system
  tags:
  - spawn
  - provenance

- name: spawnedBy
  dataType:
  - text
  description: Researcher or tool that spawned this record (e.g., "competitor", "entity_spawn")
  indexFilterable: true
  tokenization: field
  sets:
  - extended
  - system
  tags:
  - spawn
  - provenance

- name: needsDomainDiscovery
  dataType:
  - boolean
  description: Whether this domain needs domain discovery (spawned without known domain)
  indexFilterable: true
  sets:
  - extended
  - system
  tags:
  - spawn
  - processing

# ============================================================================
# PROCESSING FLAGS - SYSTEM FIELDS (pipeline-managed, except domain_research)
# ============================================================================
- name: domain_enriched
  dataType:
  - boolean
  description: Whether the domain has been successfully enriched (has title, description, or content >= 50 chars)
  indexFilterable: true
  sets:
  - standard
  - system
  tags:
  - filtering
  - processing

- name: is_blacklisted
  dataType:
  - boolean
  description: Whether the URL was blacklisted during processing
  indexFilterable: true
  sets:
  - standard
  - system
  tags:
  - filtering

- name: enrichment_attempts
  dataType:
  - int
  description: Number of failed enrichment attempts (max 3, then domain is skipped)
  indexFilterable: true
  sets:
  - standard
  - system
  tags:
  - filtering
  - processing

- name: blacklist_reason
  dataType:
  - text
  description: Reason why URL was blacklisted (if applicable)
  indexFilterable: true
  tokenization: word
  sets:
  - extended
  - system
  tags:
  - filtering

- name: page_intelligence
  dataType:
  - boolean
  description: Domain has been crawled and Page_intelligence records created
  indexFilterable: true
  indexSearchable: false
  sets:
  - standard
  - status_update
  - system
  tags:
  - pipeline
  - processing

- name: page_count
  dataType:
  - int
  description: Count of Page_intelligence records (pages) discovered for this domain
  indexFilterable: true
  sets:
  - standard
  - status_update
  - system
  tags:
  - pipeline
  - processing
  - count

- name: page_facts
  dataType:
  - boolean
  description: Pages have been scraped and Page_facts records created
  indexFilterable: true
  indexSearchable: false
  sets:
  - standard
  - status_update
  - system
  tags:
  - pipeline
  - processing

- name: page_facts_last_run_status
  dataType:
  - text
  description: Last Page_facts run outcome (scraped/failed/unknown)
  indexFilterable: true
  tokenization: field
  sets:
  - standard
  - status_update
  - system
  tags:
  - pipeline
  - processing
  - status

- name: domain_research
  dataType:
  - boolean
  description: Domain has been analyzed by the domain researcher - ALWAYS set to true
  indexFilterable: true
  indexSearchable: false
  sets:
  - standard
  - status_update
  - prompt
  tags:
  - pipeline
  - processing

# ============================================================================
# READY FOR REVIEW STATUS (Frontend Filtering)
# ============================================================================
- name: researcher_count
  dataType:
  - int
  description: Count of completed researcher analyses (0-10). Updated after each researcher completes. Used to determine ready_for_review status.
  indexFilterable: true
  sets:
  - standard
  - status_update
  - system
  tags:
  - pipeline
  - processing
  - count

- name: ready_for_review
  dataType:
  - boolean
  description: Domain is ready for frontend review. Set to true when domain_research=true AND researcher_count >= 3.
  indexFilterable: true
  indexSearchable: false
  sets:
  - standard
  - status_update
  - frontend
  tags:
  - pipeline
  - status
  - frontend

- name: ready_for_review_at
  dataType:
  - date
  description: Timestamp when domain became ready for review (ready_for_review set to true)
  indexFilterable: true
  sets:
  - standard
  - status_update
  - system
  tags:
  - temporal
  - processing

- name: processed_at
  dataType:
  - date
  description: Timestamp when this domain was last processed by any researcher
  indexFilterable: true
  sets:
  - standard
  - status_update
  - system
  tags:
  - temporal
  - processing

- name: source_quality
  dataType:
  - number
  description: Data quality score (0.0-1.0) indicating confidence in extracted data
  indexFilterable: true
  sets:
  - extended
  - system
  tags:
  - quality
  - metrics

- name: page_facts_count
  dataType:
  - int
  description: Count of unique base URLs (not chunks) with Page_facts records. Should match page_count when complete. Updated by page_facts_cli.
  indexFilterable: true
  sets:
  - extended
  - status_update
  - system
  tags:
  - pipeline
  - processing
  - count

- name: chunk_count
  dataType:
  - int
  description: Total number of Page_facts chunks (text segments) for this domain. Multiple chunks per page. Quality indicator for SPAs with lots of content.
  indexFilterable: true
  sets:
  - extended
  - status_update
  - system
  tags:
  - pipeline
  - processing
  - count
  - quality

- name: total_content_chars
  dataType:
  - int
  description: Total character count across all Page_facts content for this domain. Quality indicator - SPAs may have 1 page but lots of content.
  indexFilterable: true
  sets:
  - extended
  - status_update
  - system
  tags:
  - pipeline
  - processing
  - count
  - quality

- name: page_facts_count_updated_at
  dataType:
  - date
  description: Timestamp when page_facts_count was last updated
  sets:
  - system
  - status_update
  tags:
  - temporal
  - processing

- name: content_unreadable
  dataType:
  - boolean
  description: Whether content extraction failed for this domain (SPA/Gatsby sites) - skip in future page_facts runs
  indexFilterable: true
  sets:
  - extended
  - status_update
  - system
  tags:
  - pipeline
  - processing

- name: knowledge_base
  dataType:
  - boolean
  description: Facts have been extracted to Knowledge_base collection
  indexFilterable: true
  indexSearchable: false
  sets:
  - standard
  - status_update
  - system
  tags:
  - pipeline
  - processing

- name: analysis_type
  dataType:
  - text
  description: Type of analysis performed (e.g., "url_snapshot")
  indexFilterable: true
  tokenization: field
  sets:
  - extended
  - system
  tags:
  - categorical
  - processing

- name: updated_at
  dataType:
  - date
  description: Timestamp when record was last updated
  sets:
  - system
  - status_update
  tags:
  - temporal

# ============================================================================
# ENRICHER RESULTS (audit trail) - SYSTEM FIELD (pipeline-managed)
# ============================================================================
- name: enricherResults
  dataType:
  - object[]
  description: Array of enricher execution results with full MCPToolResponse fields
  indexSearchable: false
  sets:
  - system
  nestedProperties:
  - name: tool_name
    dataType:
    - text
    description: Name of the enricher tool (dynamic_html, head_probe, etc.)
    indexFilterable: true
    tokenization: field
  - name: success
    dataType:
    - boolean
    description: Whether the enrichment was successful
    indexFilterable: true
  - name: status
    dataType:
    - text
    description: Execution status (completed, failed, etc.)
    indexFilterable: true
    tokenization: field
  - name: execution_time_ms
    dataType:
    - number
    description: Execution time in milliseconds
    indexFilterable: true
  - name: service_name
    dataType:
    - text
    description: Service name (web_enrichers, etc.)
    indexFilterable: true
    tokenization: field
  - name: confidence_score
    dataType:
    - number
    description: Confidence score (0-1)
    indexFilterable: true
  - name: data_quality
    dataType:
    - text
    description: Data quality assessment
    indexFilterable: true
    tokenization: field
  - name: error
    dataType:
    - text
    description: Error message if failed
    indexSearchable: true
    tokenization: word
  - name: url
    dataType:
    - text
    description: URL processed
    indexFilterable: true
    tokenization: field
  - name: fetch_method
    dataType:
    - text
    description: Fetch method used (aiohttp, playwright, google_fallback)
    indexFilterable: true
    tokenization: field
  tags:
  - array
  - enrichment
  - results

# ============================================================================
# RELATIONSHIP REFERENCES (typed relationships for market traversal)
# ============================================================================
# These enable querying: "Who are X's competitors?" via reference traversal
# A domain can have multiple relationships: competitorOf:[A,B], customerOf:[C]
references:
- name: competitorOf
  target_collection: Domain
  uuid_source_field: manual
  auto_flatten: false
  description: Domains where this entity is identified as a competitor (multi-ref array)

- name: customerOf
  target_collection: Domain
  uuid_source_field: manual
  auto_flatten: false
  description: Domains where this entity is identified as a customer (multi-ref array)

- name: partnerOf
  target_collection: Domain
  uuid_source_field: manual
  auto_flatten: false
  description: Domains where this entity is identified as a partner (multi-ref array)

# ============================================================================
# SPAWN REFERENCES (DEPRECATED - use relationship refs above)
# ============================================================================
# TODO(Phase 2): Remove after migration to relationship references
- name: spawnedFromRef
  target_collection: Domain
  uuid_source_field: manual
  auto_flatten: false
  description: "[DEPRECATED] Reference to the Domain that spawned this record during research"

# ============================================================================
# REFERENCES TO RESEARCH COLLECTIONS
# ============================================================================
- name: industry
  target_collection: Research_industry
  uuid_source_field: uuid
  auto_flatten: false
  description: Industry researcher analysis for this entity
- name: financial
  target_collection: Research_financial
  uuid_source_field: uuid
  auto_flatten: false
  description: Financial researcher analysis for this entity
- name: leadership
  target_collection: Research_leadership
  uuid_source_field: uuid
  auto_flatten: false
  description: Leadership researcher analysis for this entity
- name: risk
  target_collection: Research_risk
  uuid_source_field: uuid
  auto_flatten: false
  description: Risk researcher analysis for this entity
- name: customer
  target_collection: Research_customer
  uuid_source_field: uuid
  auto_flatten: false
  description: Customer researcher analysis for this entity
- name: competitor
  target_collection: Research_competitor
  uuid_source_field: uuid
  auto_flatten: false
  description: Competitor researcher analysis for this entity
- name: journalist
  target_collection: Research_journalist
  uuid_source_field: uuid
  auto_flatten: false
  description: Journalist/media researcher analysis for this entity
- name: partner
  target_collection: Research_partner
  uuid_source_field: uuid
  auto_flatten: false
  description: Partner researcher analysis for this entity
- name: product
  target_collection: Research_product
  uuid_source_field: uuid
  auto_flatten: false
  description: Product researcher analysis for this entity
- name: social
  target_collection: Research_social
  uuid_source_field: uuid
  auto_flatten: false
  description: Social researcher analysis for this entity

# ============================================================================
# COLLECTION METADATA
# ============================================================================
collection_name: domain
uuid_strategy:
  fields:
  - field: domain
    namespace: URL
    description: Primary strategy using domain for deterministic UUIDs
  - field: url
    namespace: URL
    description: Fallback strategy using full URL for deterministic UUIDs
dependencies:
- type: foundational
data_sources:
  entity_source: Domain
  source_collection: Source
collection_groups:
- url_collections
schema_config:
  additional_properties: true
id: Domain
name: Domain
