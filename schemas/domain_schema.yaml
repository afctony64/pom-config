type: core
class: Domain
version: 9.0
group: url
weaviate_instance: cloud
description: |
  Domain collection - THE UNIVERSAL ENTITY COLLECTION.
  
  KEY CONCEPT: The Entity IS the Domain record.
  - URL is the entity's digital signature (identity)
  - Domain represents BOTH digital and physical presence
  - Could be: company, destination, recipe, film, book
  - Tenant isolation defines whose research it is
  - TenantGroup defines which researchers to run
  - Everything else is DISCOVERED by enrichers and researchers
  
  FLOW:
  1. URL seed → Domain record created (entity exists)
  2. Enrichers discover: content, social_accounts, sitemaps, etc.
  3. TenantGroup.researchers analyze → Research_* collections
  4. Research records reference back to this Domain
  
  SCHEMA v9.0 CHANGES:
  - Added physical presence fields (phone, email, address, etc.)
  - Consolidated social fields (15 → 10)
  - Removed 52 unused legacy fields
  - Removed Company_ references

vectorConfig:
  default:
    text2vec-weaviate:
      model: sentence-transformers/all-MiniLM-L6-v2
      vectorizeClassName: true
      sourceProperties:
      - title
      - description
      - content
multiTenancyConfig:
  enabled: true
  autoTenantCreation: true
  autoTenantActivation: true
invertedIndexConfig:
  indexNullState: true
  indexTimestamps: false
  indexPropertyLength: false
  cleanupIntervalSeconds: 60
  bm25:
    b: 0.75
    k1: 1.2

properties:
# ============================================================================
# IDENTITY (5 fields)
# ============================================================================
- name: url
  dataType:
  - text
  description: Primary URL - THE ENTITY'S DIGITAL SIGNATURE (unique identity)
  indexFilterable: true
  tokenization: field
  indexSearchable: true
  indexInverted: true
  sets:
  - standard
  - status_update
  tags:
  - identity
  - web
  - research  # FIX #457: Include in research data card traversals

- name: domain
  dataType:
  - text
  description: Domain extracted from URL
  indexFilterable: true
  tokenization: field
  indexSearchable: true
  sets:
  - standard
  - status_update
  tags:
  - research  # FIX #457: Include in research data card traversals
  - categorical
  - web

- name: entityType
  dataType:
  - text
  description: Entity type derived from TenantGroup (Company, Destination, Recipe, Film, Book)
  indexFilterable: true
  tokenization: field
  sets:
  - standard
  tags:
  - identity
  - categorical
  - research  # FIX #457: Include in research data card traversals

- name: title
  dataType:
  - text
  description: Page title extracted from URL snapshot
  indexSearchable: true
  tokenization: word
  sets:
  - standard
  tags:
  - content
  - metadata

- name: entityName
  dataType:
  - text
  description: Human-readable entity name (e.g., "Paragon" instead of "useparagon.com")
  label: Entity Name
  indexSearchable: true
  tokenization: word
  sets:
  - standard
  tags:
  - identity
  - metadata
  - research  # FIX #457: Include in research data card traversals

- name: description
  dataType:
  - text
  description: Page description/meta description from URL snapshot
  indexSearchable: true
  tokenization: word
  sets:
  - standard
  tags:
  - content
  - metadata
  - research  # FIX #457: Include in research data card traversals

# ============================================================================
# PHYSICAL PRESENCE (8 fields) - NEW in v9.0
# ============================================================================
- name: phone
  dataType:
  - text
  description: Primary phone number discovered from website
  indexFilterable: true
  tokenization: field
  sets:
  - extended
  tags:
  - contact
  - physical

- name: email
  dataType:
  - text
  description: Primary contact email discovered from website
  indexFilterable: true
  tokenization: field
  sets:
  - extended
  tags:
  - contact
  - physical

- name: address
  dataType:
  - text
  description: Full street address
  indexSearchable: true
  tokenization: word
  sets:
  - extended
  tags:
  - location
  - physical

- name: city
  dataType:
  - text
  description: City name
  indexFilterable: true
  tokenization: field
  sets:
  - extended
  tags:
  - location
  - physical

- name: region
  dataType:
  - text
  description: State/Province/Region
  indexFilterable: true
  tokenization: field
  sets:
  - extended
  tags:
  - location
  - physical

- name: country
  dataType:
  - text
  description: Country name or ISO code
  indexFilterable: true
  tokenization: field
  sets:
  - extended
  tags:
  - location
  - physical

- name: postalCode
  dataType:
  - text
  description: Postal/ZIP code
  indexFilterable: true
  tokenization: field
  sets:
  - extended
  tags:
  - location
  - physical

- name: coordinates
  dataType:
  - geoCoordinates
  description: Geographic coordinates (latitude, longitude)
  sets:
  - extended
  tags:
  - location
  - physical

# ============================================================================
# CONTENT QUALITY (5 fields)
# ============================================================================
- name: content
  dataType:
  - text
  description: Page content extracted from URL snapshot
  indexSearchable: true
  tokenization: word
  sets:
  - extended
  tags:
  - content
  - enriched

- name: content_quality_score
  dataType:
  - number
  description: Content quality score (0-1) from dynamic_html enricher
  indexFilterable: true
  sets:
  - extended
  tags:
  - metrics
  - quality

- name: site_readable
  dataType:
  - boolean
  description: Whether the site content was successfully readable
  indexFilterable: true
  sets:
  - extended
  tags:
  - accessibility

- name: seo_maturity
  dataType:
  - text
  description: SEO sophistication level from robots_txt analysis (basic/intermediate/advanced/unknown)
  indexFilterable: true
  tokenization: field
  sets:
  - extended
  tags:
  - seo
  - maturity

- name: crawl_openness
  dataType:
  - text
  description: Crawling accessibility from robots_txt analysis (open/restricted/blocked/unknown)
  indexFilterable: true
  tokenization: field
  sets:
  - extended
  tags:
  - crawling
  - accessibility

# ============================================================================
# SOCIAL PRESENCE (10 fields - consolidated from 15)
# ============================================================================
- name: social_accounts
  dataType:
  - text
  description: JSON string of discovered social media accounts by platform
  indexSearchable: true
  sets:
  - standard
  tags:
  - accounts
  - social
  - digital

- name: social_platforms
  dataType:
  - text[]
  description: Array of social media platforms detected
  indexFilterable: true
  indexSearchable: true
  sets:
  - extended
  tags:
  - discovery
  - platforms
  - social
  - digital

- name: social_accounts_found
  dataType:
  - int
  description: Number of social media accounts discovered
  indexFilterable: true
  sets:
  - extended
  tags:
  - accounts
  - discovery
  - social
  - digital

- name: social_engagement_score
  dataType:
  - int
  description: Social engagement score from deep analysis (0-100)
  indexFilterable: true
  sets:
  - extended
  tags:
  - engagement
  - metrics
  - social
  - digital

- name: social_presence_tier
  dataType:
  - text
  description: Social presence tier (Strong/Good/Basic/Minimal) from social_snapshot enricher
  indexFilterable: true
  tokenization: field
  sets:
  - extended
  tags:
  - categorical
  - social
  - tier
  - digital

- name: has_social_auth
  dataType:
  - boolean
  description: Whether site has social authentication options
  indexFilterable: true
  sets:
  - extended
  tags:
  - authentication
  - features
  - social
  - digital

- name: has_social_sharing
  dataType:
  - boolean
  description: Whether site has social sharing features
  indexFilterable: true
  sets:
  - extended
  tags:
  - features
  - sharing
  - social
  - digital

- name: has_community_features
  dataType:
  - boolean
  description: Whether site has community/engagement features
  indexFilterable: true
  sets:
  - extended
  tags:
  - community
  - features
  - social
  - digital

- name: social_authentication
  dataType:
  - text[]
  description: Array of social authentication methods detected
  indexSearchable: true
  sets:
  - standard
  tags:
  - authentication
  - social
  - digital

- name: social_sharing_features
  dataType:
  - text[]
  description: Array of social sharing features detected
  indexSearchable: true
  sets:
  - standard
  tags:
  - sharing
  - social
  - digital

# ============================================================================
# SECURITY PROFILE (8 fields)
# ============================================================================
- name: is_secure
  dataType:
  - boolean
  description: Overall security assessment from http_security_headers enricher
  indexFilterable: true
  sets:
  - extended
  tags:
  - security

- name: security_grade
  dataType:
  - text
  description: Security grade (A/B/C/D/F) from http_security_headers enricher
  indexFilterable: true
  tokenization: field
  sets:
  - extended
  tags:
  - security
  - grade

- name: security_score
  dataType:
  - int
  description: Security score (0-100) from http_security_headers enricher
  indexFilterable: true
  sets:
  - extended
  tags:
  - metrics
  - security

- name: has_hsts
  dataType:
  - boolean
  description: Has HTTP Strict Transport Security header
  indexFilterable: true
  sets:
  - extended
  tags:
  - security
  - headers

- name: has_csp
  dataType:
  - boolean
  description: Has Content Security Policy header
  indexFilterable: true
  sets:
  - extended
  tags:
  - security
  - headers

- name: has_frame_options
  dataType:
  - boolean
  description: Has X-Frame-Options header
  indexFilterable: true
  sets:
  - extended
  tags:
  - security
  - headers

- name: has_content_type_options
  dataType:
  - boolean
  description: Has X-Content-Type-Options header
  indexFilterable: true
  sets:
  - extended
  tags:
  - security
  - headers

- name: bot_protected
  dataType:
  - boolean
  description: Whether site has bot protection detected
  indexFilterable: true
  sets:
  - extended
  tags:
  - security
  - protection

# ============================================================================
# TECHNICAL PROFILE (6 fields)
# ============================================================================
- name: requires_browser
  dataType:
  - boolean
  description: Whether this site requires browser/Playwright for page scraping (JS-rendered or bot-protected)
  indexFilterable: true
  sets:
  - extended
  - status_update
  tags:
  - processing
  - browser

- name: captcha_detected
  dataType:
  - boolean
  description: Whether CAPTCHA/bot protection was detected during enrichment
  indexFilterable: true
  sets:
  - extended
  tags:
  - processing
  - browser

- name: has_ipv4
  dataType:
  - boolean
  description: Has IPv4 addresses from dns_fingerprint enricher
  indexFilterable: true
  sets:
  - extended
  tags:
  - dns
  - network

- name: has_ipv6
  dataType:
  - boolean
  description: Has IPv6 addresses from dns_fingerprint enricher
  indexFilterable: true
  sets:
  - extended
  tags:
  - dns
  - network

- name: business_technology
  dataType:
  - text
  description: Technology stack indicators from robots_txt analysis
  indexSearchable: true
  tokenization: word
  sets:
  - extended
  tags:
  - technology
  - digital

- name: robots_rules_count
  dataType:
  - number
  description: Number of rules found in robots.txt
  indexFilterable: true
  sets:
  - extended
  tags:
  - robots
  - technical

# ============================================================================
# URL DISCOVERY (kept per user requirement)
# ============================================================================
- name: all_sitemap_urls
  dataType:
  - text[]
  description: Complete list of all sitemap URLs discovered
  indexSearchable: true
  sets:
  - url_discovery
  tags:
  - sitemap
  - urls

- name: discovered_sitemaps
  dataType:
  - text[]
  description: XML sitemap URLs discovered by sitemap_discovery enricher
  indexSearchable: true
  sets:
  - url_discovery
  tags:
  - sitemap
  - urls

- name: robots_sitemap_urls
  dataType:
  - text[]
  description: Sitemap URLs found in robots.txt
  indexFilterable: false
  sets:
  - url_discovery
  tags:
  - sitemap
  - urls

- name: homepage_urls_discovered
  dataType:
  - text[]
  description: URLs discovered from homepage parsing by homepage_parser enricher
  indexSearchable: true
  sets:
  - url_discovery
  tags:
  - homepage
  - urls

- name: primary_sitemap
  dataType:
  - text
  description: Primary sitemap URL for URL discovery
  indexFilterable: true
  tokenization: field
  sets:
  - url_discovery
  tags:
  - sitemap
  - primary

- name: sitemap_discovery_method
  dataType:
  - text
  description: Method used to discover sitemaps (robots_txt/well_known/dns)
  indexFilterable: true
  tokenization: field
  sets:
  - extended
  tags:
  - discovery
  - method

- name: total_sitemaps_discovered
  dataType:
  - int
  description: Total number of sitemaps discovered
  indexFilterable: true
  sets:
  - extended
  tags:
  - sitemap
  - count

# ============================================================================
# HOMEPAGE DISCOVERY STATS
# ============================================================================
- name: homepage_total_links
  dataType:
  - int
  description: Total number of links found on homepage
  indexFilterable: true
  sets:
  - extended
  tags:
  - homepage
  - count

- name: homepage_valid_content_urls
  dataType:
  - int
  description: Count of valid content URLs extracted from homepage
  indexFilterable: true
  sets:
  - extended
  tags:
  - homepage
  - count

- name: homepage_discovery_method
  dataType:
  - text
  description: Method used for homepage discovery (direct/redirect)
  indexFilterable: true
  tokenization: field
  sets:
  - extended
  tags:
  - homepage
  - method

- name: homepage_has_navigation
  dataType:
  - boolean
  description: Whether homepage has navigation menu
  indexFilterable: true
  sets:
  - extended
  tags:
  - homepage
  - structure

- name: homepage_has_footer
  dataType:
  - boolean
  description: Whether homepage has footer section
  indexFilterable: true
  sets:
  - extended
  tags:
  - homepage
  - structure

- name: homepage_has_main_content
  dataType:
  - boolean
  description: Whether homepage has main content area
  indexFilterable: true
  sets:
  - extended
  tags:
  - homepage
  - structure

- name: homepage_social_links
  dataType:
  - int
  description: Count of social media links found on homepage
  indexFilterable: true
  sets:
  - extended
  tags:
  - homepage
  - social

- name: homepage_contact_indicators
  dataType:
  - int
  description: Count of contact indicators found on homepage
  indexFilterable: true
  sets:
  - extended
  tags:
  - homepage
  - contact

# ============================================================================
# SPAWN/SEED FIELDS (3 fields) - For entity_spawn post-execution tool
# ============================================================================
- name: seed
  dataType:
  - boolean
  description: Whether this domain was spawned and needs enrichment
  indexFilterable: true
  sets:
  - extended
  tags:
  - spawn
  - processing

- name: spawnedFrom
  dataType:
  - text
  description: Domain that spawned this record (e.g., source domain for competitor)
  indexFilterable: true
  tokenization: field
  sets:
  - extended
  tags:
  - spawn
  - provenance

- name: spawnedBy
  dataType:
  - text
  description: Researcher or tool that spawned this record (e.g., "competitor", "entity_spawn")
  indexFilterable: true
  tokenization: field
  sets:
  - extended
  tags:
  - spawn
  - provenance

- name: needsDomainDiscovery
  dataType:
  - boolean
  description: Whether this domain needs domain discovery (spawned without known domain)
  indexFilterable: true
  sets:
  - extended
  tags:
  - spawn
  - processing

# ============================================================================
# PROCESSING FLAGS (8 fields)
# ============================================================================
- name: domain_enriched
  dataType:
  - boolean
  description: Whether the domain has been successfully enriched (has title, description, or content >= 50 chars)
  indexFilterable: true
  sets:
  - standard
  tags:
  - filtering
  - processing

- name: is_blacklisted
  dataType:
  - boolean
  description: Whether the URL was blacklisted during processing
  indexFilterable: true
  sets:
  - standard
  tags:
  - filtering

- name: blacklist_reason
  dataType:
  - text
  description: Reason why URL was blacklisted (if applicable)
  indexFilterable: true
  tokenization: word
  sets:
  - extended
  tags:
  - filtering

- name: page_intelligence
  dataType:
  - boolean
  description: Domain has been crawled and Page_intelligence records created
  indexFilterable: true
  indexSearchable: false
  sets:
  - standard
  - status_update
  tags:
  - pipeline
  - processing

- name: page_count
  dataType:
  - int
  description: Count of Page_intelligence records (pages) discovered for this domain
  indexFilterable: true
  sets:
  - standard
  - status_update
  tags:
  - pipeline
  - processing
  - count

- name: page_facts
  dataType:
  - boolean
  description: Pages have been scraped and Page_facts records created
  indexFilterable: true
  indexSearchable: false
  sets:
  - standard
  - status_update
  tags:
  - pipeline
  - processing

- name: page_facts_count
  dataType:
  - int
  description: Count of Page_facts records (chunks) for this domain. Used for efficient filtering in page_facts_cli.
  indexFilterable: true
  sets:
  - extended
  - status_update
  tags:
  - pipeline
  - processing
  - count

- name: page_facts_count_updated_at
  dataType:
  - date
  description: Timestamp when page_facts_count was last updated
  sets:
  - system
  - status_update
  tags:
  - temporal
  - processing

- name: content_unreadable
  dataType:
  - boolean
  description: Whether content extraction failed for this domain (SPA/Gatsby sites) - skip in future page_facts runs
  indexFilterable: true
  sets:
  - extended
  - status_update
  tags:
  - pipeline
  - processing

- name: knowledge_base
  dataType:
  - boolean
  description: Facts have been extracted to Knowledge_base collection
  indexFilterable: true
  indexSearchable: false
  sets:
  - standard
  - status_update
  tags:
  - pipeline
  - processing

- name: analysis_type
  dataType:
  - text
  description: Type of analysis performed (e.g., "url_snapshot")
  indexFilterable: true
  tokenization: field
  sets:
  - extended
  tags:
  - categorical
  - processing

- name: updated_at
  dataType:
  - date
  description: Timestamp when record was last updated
  sets:
  - system
  - status_update
  tags:
  - temporal

# ============================================================================
# ENRICHER RESULTS (audit trail)
# ============================================================================
- name: enricherResults
  dataType:
  - object[]
  description: Array of enricher execution results with full MCPToolResponse fields
  indexSearchable: false
  nestedProperties:
  - name: tool_name
    dataType:
    - text
    description: Name of the enricher tool (dynamic_html, head_probe, etc.)
    indexFilterable: true
    tokenization: field
  - name: success
    dataType:
    - boolean
    description: Whether the enrichment was successful
    indexFilterable: true
  - name: status
    dataType:
    - text
    description: Execution status (completed, failed, etc.)
    indexFilterable: true
    tokenization: field
  - name: execution_time_ms
    dataType:
    - number
    description: Execution time in milliseconds
    indexFilterable: true
  - name: service_name
    dataType:
    - text
    description: Service name (web_enrichers, etc.)
    indexFilterable: true
    tokenization: field
  - name: confidence_score
    dataType:
    - number
    description: Confidence score (0-1)
    indexFilterable: true
  - name: data_quality
    dataType:
    - text
    description: Data quality assessment
    indexFilterable: true
    tokenization: field
  - name: error
    dataType:
    - text
    description: Error message if failed
    indexSearchable: true
    tokenization: word
  - name: url
    dataType:
    - text
    description: URL processed
    indexFilterable: true
    tokenization: field
  - name: fetch_method
    dataType:
    - text
    description: Fetch method used (aiohttp, playwright, google_fallback)
    indexFilterable: true
    tokenization: field
  tags:
  - array
  - enrichment
  - results

# ============================================================================
# SPAWN REFERENCES (self-referencing for entity discovery graph)
# ============================================================================
references:
- name: spawnedFromRef
  target_collection: Domain
  uuid_source_field: manual
  auto_flatten: false
  description: Reference to the Domain that spawned this record during research

# ============================================================================
# REFERENCES TO RESEARCH COLLECTIONS
# ============================================================================
- name: industry
  target_collection: Research_industry
  uuid_source_field: uuid
  auto_flatten: false
  description: Industry researcher analysis for this entity
- name: financial
  target_collection: Research_financial
  uuid_source_field: uuid
  auto_flatten: false
  description: Financial researcher analysis for this entity
- name: leadership
  target_collection: Research_leadership
  uuid_source_field: uuid
  auto_flatten: false
  description: Leadership researcher analysis for this entity
- name: risk
  target_collection: Research_risk
  uuid_source_field: uuid
  auto_flatten: false
  description: Risk researcher analysis for this entity
- name: customer
  target_collection: Research_customer
  uuid_source_field: uuid
  auto_flatten: false
  description: Customer researcher analysis for this entity
- name: competitor
  target_collection: Research_competitor
  uuid_source_field: uuid
  auto_flatten: false
  description: Competitor researcher analysis for this entity
- name: journalist
  target_collection: Research_journalist
  uuid_source_field: uuid
  auto_flatten: false
  description: Journalist/media researcher analysis for this entity
- name: partner
  target_collection: Research_partner
  uuid_source_field: uuid
  auto_flatten: false
  description: Partner researcher analysis for this entity
- name: product
  target_collection: Research_product
  uuid_source_field: uuid
  auto_flatten: false
  description: Product researcher analysis for this entity
- name: social
  target_collection: Research_social
  uuid_source_field: uuid
  auto_flatten: false
  description: Social researcher analysis for this entity

# ============================================================================
# COLLECTION METADATA
# ============================================================================
collection_name: domain
uuid_strategy:
  fields:
  - field: domain
    namespace: URL
    description: Primary strategy using domain for deterministic UUIDs
  - field: url
    namespace: URL
    description: Fallback strategy using full URL for deterministic UUIDs
dependencies:
- type: foundational
data_sources:
  entity_source: Domain
  source_collection: Source
collection_groups:
- url_collections
schema_config:
  additional_properties: true
id: Domain
name: Domain
