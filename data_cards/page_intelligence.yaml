# Data Card: Page Intelligence
#
# Purpose: Fetch Page_intelligence records with standard field set
# Use Case: Get page intelligence data for analysis
#
# âœ… Native fetch executor with standard field set
# âš ï¸  NOTE: Company_source reference REMOVED - cross-cluster references not supported
#     Page_intelligence is on Spark cluster, Company_source is on Cloud cluster

id: page_intelligence
name: Page Intelligence
type: data_card
file: page_intelligence.yaml
description: >
  Fetches Page_intelligence records with standard field set including core properties.
  Uses Native fetch executor for efficient data retrieval.

# Tagging system
tags:
  - page-intelligence
  - url
  - raw-data
  - intelligence

target_scope: page_intelligence

# âœ… STANDARD: Use 'fetch' for all data cards
executor: fetch

# ðŸŽ¨ Frontend Display Control
# Hidden from frontend dropdowns (internal data, not user-facing)
display: false

# Disable relationship traversal - cross-cluster references not supported
relationship_support: false

# Access control
personas:
  - "*"

# Query parameters
parameters:
  type: fetch  # Must match executor

  # Root collection
  collection: Page_intelligence

  # Relationship traversal configuration - DISABLED for multi-cluster
  relationship_traversal: false
  dynamic_templates: true

  # Reference fields - REMOVED (cross-cluster not supported)
  references: []

  # Field tags for reference collections
  field_tags: []

  # Limits
  limit: 50
  limit_default: 50

  # Field set configuration
  field_set: standard
  field_set_default: standard
  field_set_options:
    - standard
    - extended

# Field definitions for each field set
field_sets:
  standard:
    description: "Core page intelligence fields"
    fields:
      - name: url
        type: text
        source: property
        description: Page URL

      - name: domain
        type: text
        source: property
        description: Domain extracted from URL

      - name: path
        type: text
        source: property
        description: URL path component

      - name: business_value
        type: number
        source: property
        description: Business value score (0.0-1.0)

      - name: research_relevance
        type: number
        source: property
        description: Research relevance score (0.0-1.0)

      - name: discovered_at
        type: int
        source: property
        description: Unix seconds when page was discovered

      - name: crawled_at
        type: int
        source: property
        description: Unix seconds when page was crawled

      - name: language
        type: text
        source: property
        description: ISO language code (e.g., en, it)

      - name: accessible
        type: boolean
        source: property
        description: Whether page is accessible

      - name: content_type
        type: text
        source: property
        description: HTTP content type

      - name: status_code
        type: int
        source: property
        description: HTTP status code

      - name: success
        type: boolean
        source: property
        description: Module-level success indicator

      - name: discovery_method
        type: text
        source: property
        description: Method used to discover this URL

  extended:
    description: "Full page intelligence with all available fields"
    fields:
      # All standard fields
      - name: url
        type: text
        source: property
        description: Page URL

      - name: domain
        type: text
        source: property
        description: Domain extracted from URL

      - name: path
        type: text
        source: property
        description: URL path component

      - name: business_value
        type: number
        source: property
        description: Business value score (0.0-1.0)

      - name: research_relevance
        type: number
        source: property
        description: Research relevance score (0.0-1.0)

      - name: discovered_at
        type: int
        source: property
        description: Unix seconds when page was discovered

      - name: crawled_at
        type: int
        source: property
        description: Unix seconds when page was crawled

      - name: language
        type: text
        source: property
        description: ISO language code (e.g., en, it)

      - name: accessible
        type: boolean
        source: property
        description: Whether page is accessible

      - name: content_type
        type: text
        source: property
        description: HTTP content type

      - name: status_code
        type: int
        source: property
        description: HTTP status code

      - name: success
        type: boolean
        source: property
        description: Module-level success indicator

      - name: discovery_method
        type: text
        source: property
        description: Method used to discover this URL

      - name: content_category
        type: text
        source: property
        description: Content category classification

      - name: enrichment
        type: text
        source: property
        description: Enrichment status and metadata

      - name: processing_version
        type: text
        source: property
        description: Pipeline version that produced this record

      # Reference fields
# Collections configuration - no cross-cluster references
collections:
  - collection: Page_intelligence
    field_set: standard
    required: true
    # references: REMOVED - Company_source is on different cluster (Cloud vs Spark)

# Query behavior
supports_relationships: false  # Cross-cluster references not supported
supports_aggregation: false
supports_grouping: true
requires_query_text: false

# Performance settings
default_limit: 50
max_limit: 1000
timeout_seconds: 30

# Examples for documentation
examples:
  - description: Basic query with standard fields
    code: |
      result = await execute_data_card(
          data_card_id="page_intelligence",
          limit=10
      )

  - description: Extended fields query
    code: |
      result = await execute_data_card(
          data_card_id="page_intelligence",
          field_set="extended",
          limit=10
      )

  - description: Query with all fields
    code: |
      result = await execute_data_card(
          data_card_id="page_intelligence",
          field_set="extended",
          limit=10
      )
