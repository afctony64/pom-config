id: research_by_researcher_id
collection: Research_product  # Default fallback - will be overridden by researcher_id parameter
name: Research by Type
type: data_card
file: research_by_researcher_id.yaml
description: >
  Query a specific Research_* collection by researcher_id parameter.
  DataFactory automatically resolves researcher_id to collection name (Research_{researcher_id}).
  Supports all field types (Cat, LLM, research) for focused analysis on one researcher type.

# Tagging system
tags:
  - research
  - single-researcher
  - focused-analysis
  - entity-intelligence
  - entity-model

target_scope: entity_intelligence
executor: fetch  # âœ… Use native methods (native methods)

# ðŸŽ¨ Frontend Display Control
display: true  # User-facing card for single researcher queries
relationship_support: true  # Optional traversal via enable_traversal

personas:
  - "*"

parameters:
  type: fetch  # Legacy parameter format (for compatibility)

  # Default collection (fallback if researcher_id not provided)
  collection: Research_product

  # âœ… KEY PARAMETER: researcher_id resolves to Research_{researcher_id}
  # DataFactory handles resolution using tenant group config
  # Options: industry, financial, product, customer, leadership, competitor, partner, risk, journalist, social
  researcher_id: product  # Default, can be overridden by user

  # No traversal needed - single collection query
  relationship_traversal: false
  dynamic_templates: false

  # Optional traversal for deep-dive researchers (customer/competitor/partner)
  enable_traversal: false
  reference_field: null
  preserve_reference_arrays: false

  # Traversal depth control - prevents Domain fields from being included when traversing to Research_*
  traversal:
    max_depth: 2  # Research_* â†’ Domain (1) â†’ Research_* properties resolved (2), Domain fields excluded at depth 2
    max_complexity: 200
    policies:
      domainBeacon: skip  # Skip circular Domain refs from researchers

  # Fetch limits
  limit: 1000
  limit_default: 1000

# ðŸŽ¯ TAG-BASED FILTERING - Fetch all field types by default
# No explicit fields - let the system resolve based on tags!
fields: {}

# Specify tags to include (all field types)
field_tags:
  - Cat
  - LLM
  - research

# Single collection configuration
# âœ… FIX: Added field_set to include array fields as described in description
collections:
  - collection: Research_product  # Default fallback - DataFactory will override based on researcher_id
    field_set: [standard, extended, array]  # Include arrays for complete data
    required: true
    references:
      domainBeacon:
        target_collection: Domain
        # âœ… FRONTEND REQUIREMENT: Only show entities ready for review
        filters:
          - field: ready_for_review
            operator: equal
            value: true
      keyCustomerRefs:
        target_collection: Domain
        fields: [domain]  # Only fetch domain field - no further traversal
      keyCompetitorRefs:
        target_collection: Domain
        fields: [domain]  # Only fetch domain field - minimal for traversal
        references:
          industry:
            target_collection: Research_industry
            field_set: [standard]
          financial:
            target_collection: Research_financial
            field_set: [standard]
          product:
            target_collection: Research_product
            field_set: [standard]
          leadership:
            target_collection: Research_leadership
            field_set: [standard]
          customer:
            target_collection: Research_customer
            field_set: [standard]
          competitor:
            target_collection: Research_competitor
            field_set: [standard]
          partner:
            target_collection: Research_partner
            field_set: [standard]
          journalist:
            target_collection: Research_journalist
            field_set: [standard]
          social:
            target_collection: Research_social
            field_set: [standard]
          risk:
            target_collection: Research_risk
            field_set: [standard]
      keyPartnerRefs:
        target_collection: Domain
        fields: [domain]  # Only fetch domain field - minimal for traversal
        references:
          industry:
            target_collection: Research_industry
            field_set: [standard]
          financial:
            target_collection: Research_financial
            field_set: [standard]
          product:
            target_collection: Research_product
            field_set: [standard]
          leadership:
            target_collection: Research_leadership
            field_set: [standard]
          customer:
            target_collection: Research_customer
            field_set: [standard]
          competitor:
            target_collection: Research_competitor
            field_set: [standard]
          partner:
            target_collection: Research_partner
            field_set: [standard]
          journalist:
            target_collection: Research_journalist
            field_set: [standard]
          social:
            target_collection: Research_social
            field_set: [standard]
          risk:
            target_collection: Research_risk
            field_set: [standard]

# Chat intelligence integration
chat_integration:
  best_for:
    - "Focused analysis on one researcher type"
    - "Single researcher queries (product, financial, industry, etc.)"
    - "Performance optimization (single collection)"
    - "Researcher-specific reports"

  usage_patterns:
    - "Returns all Cat, LLM, and research fields for one researcher"
    - "Automatically resolves researcher_id to collection name"
    - "Works with Entity Model: Research_* collections"

  parameter_examples:
    - name: "Product research only"
      params: {researcher_id: "product", limit: 100}
    - name: "Financial research only"
      params: {researcher_id: "financial", limit: 100}
    - name: "Industry research only"
      params: {researcher_id: "industry", limit: 100}

# Response structure
response_structure:
  root_object: Research_*  # Dynamic based on researcher_id
  includes_relationships: false
  field_focus: all_research_fields
  expected_collections:
    - Research_industry
    - Research_financial
    - Research_product
    - Research_customer
    - Research_leadership
    - Research_competitor
    - Research_partner
    - Research_risk
    - Research_journalist
    - Research_social

# Documentation
documentation:
  overview: |
    This data card queries a single Research_* collection based on researcher_id parameter.
    DataFactory automatically resolves researcher_id to the correct collection name using
    tenant group configuration.

    Works with Entity Model: Research_* collections.

  researcher_resolution: |
    RESEARCHER ID RESOLUTION:

    User provides: researcher_id="product"
    DataFactory resolves: Research_product

    Supported researcher_ids:
    - industry
    - financial
    - product
    - customer
    - leadership
    - competitor
    - partner
    - risk
    - journalist
    - social

  usage_examples:
    - name: "Query product research"
      query: "data_card_id: research_by_researcher_id, parameters: {researcher_id: 'product', limit: 100}"
      notes: "Gets all fields from Research_product collection"

    - name: "Query financial research"
      query: "data_card_id: research_by_researcher_id, parameters: {researcher_id: 'financial', limit: 100}"

    - name: "Query industry research"
      query: "data_card_id: research_by_researcher_id, parameters: {researcher_id: 'industry', limit: 100}"

  performance: |
    Fast (single collection) - ~1-2 seconds for 100 records
    Ideal for focused analysis on one researcher type
    No traversal overhead - direct collection query
