# Data Card: Page Content by Researcher Type
#
# Purpose: Fetch high-scoring page content for a specific researcher type
# Use Case: Alternative data source for researchers when Fact_base is not ready
#
# ‚úÖ Routes to Cloud Weaviate (Page_researcher + Page_content)
# ‚úÖ Filters by researcher type and domain
# ‚úÖ Returns actual page content with scores

id: page_content_by_researcher
name: Page Content by Researcher Type
type: data_card
file: page_content_by_researcher.yaml
description: >
  Fetches high-scoring page content for a specific researcher type.
  Uses Page_researcher collection to identify relevant pages by researcher_score,
  then fetches the corresponding Page_content records.

  This is the FALLBACK approach when Fact_base/Knowledge_base is not ready.

  Routes to Cloud Weaviate instance.

# Tagging system
tags:
  - page-content
  - researcher
  - page-researcher
  - fallback
  - cloud-weaviate

target_scope: researcher

# üé® Frontend Display Control
display: false  # Internal use only

# ‚úÖ STANDARD: Use 'fetch' for all data cards
executor: fetch

# No relationship traversal (simple filter query)
relationship_support: false

# Access control
personas:
  - "*"

# Query parameters
parameters:
  type: fetch

  # Root collection - Page_researcher stores researcher scores
  collection: Page_researcher

  # Domain filter (REQUIRED for multi-tenant)
  domain: ""

  # Primary researcher type filter
  # Options: industry, product, customer, leadership, partner, risk, financial, competitor, journalist, social
  primary_researcher: ""

  # Minimum score threshold (0-1)
  min_score: 0.5

  # No relationship traversal
  relationship_traversal: false
  dynamic_templates: true

  # Limits
  limit: 10
  limit_default: 10

  # Field set configuration
  field_set: standard
  field_set_default: standard
  field_set_options:
    - standard
    - extended

# Field definitions for each field set
field_sets:
  standard:
    description: "Core page researcher fields with content UUID for follow-up fetch"
    fields:
      - name: url
        type: text
        source: property
        description: Page URL

      - name: domain
        type: text
        source: property
        description: Domain name

      - name: primary_score
        type: number
        source: property
        description: Primary researcher score (0-1)

      - name: primary_researcher
        type: text
        source: property
        description: Primary researcher type

      - name: page_content_uuid
        type: text
        source: property
        description: UUID of linked Page_content record

  extended:
    description: "Full page researcher fields"
    fields:
      - name: url
        type: text
        source: property
        description: Page URL

      - name: domain
        type: text
        source: property
        description: Domain name

      - name: primary_score
        type: number
        source: property
        description: Primary researcher score (0-1)

      - name: primary_researcher
        type: text
        source: property
        description: Primary researcher type

      - name: page_content_uuid
        type: text
        source: property
        description: UUID of linked Page_content record

      - name: researchers
        type: text_array
        source: property
        description: Array of researcher types

      - name: total_researchers
        type: int
        source: property
        description: Count of qualifying researchers

      - name: scored_at
        type: int
        source: property
        description: Unix timestamp when page was scored

# Query behavior
supports_relationships: false
supports_aggregation: false
supports_grouping: false
requires_query_text: false

# Performance settings
default_limit: 10
max_limit: 50
timeout_seconds: 30

# Examples for documentation
examples:
  - description: Fetch leadership pages for prismatic.io
    code: |
      from pom_core.database.data_factory import DataFactory
      from pom_core.models.data_model import DataRequest

      result = await data_factory.get_data(
          data_card_id="page_content_by_researcher",
          user_input=DataRequest(
              collection="Page_researcher",
              parameters={
                  "domain": "prismatic.io",
                  "primary_researcher": "leadership",
                  "min_score": 0.5,
                  "limit": 10
              }
          )
      )

notes: |
  ‚ö†Ô∏è  TWO-STEP FETCH REQUIRED:

  This data card returns Page_researcher records which contain page_content_uuid.
  To get the actual content, a second fetch to Page_content is required.

  The researcher_with_pages.prompty handles this two-step process automatically.

  ---

  RESEARCHER TYPES:
  - industry, product, customer, leadership, partner
  - risk, financial, competitor, journalist, social
