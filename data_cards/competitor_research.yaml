id: competitor_research
collection: Research_competitor  # Start from researcher, not Domain
name: Competitor Research
type: data_card
file: competitor_research.yaml
description: >
  Fetch Research_competitor records with Domain via explicit reference.
  Uses Research_competitor as root and traverses to Domain via domainBeacon.
  
  KEY: dynamic_templates: false prevents auto-discovery of Domain's other references.
  This ensures only competitor + domain data is fetched.

# Tagging system
tags:
  - research
  - competitor
  - entity-intelligence
  - focused

target_scope: entity_intelligence
executor: fetch

# Frontend Display Control
display: true
relationship_support: true

personas:
  - "*"

parameters:
  type: fetch
  collection: Research_competitor  # ROOT IS RESEARCHER
  relationship_traversal: true     # ✅ Allow explicit reference traversal
  dynamic_templates: false         # ❌ DISABLE auto-discovery of nested refs
  limit: 10000
  limit_default: 10000
  
  # Data card level field_set
  field_set: [standard, extended, array]

# No explicit fields - resolved by field_set
fields: {}

# Tags for field filtering
field_tags:
  - Cat
  - LLM
  - research

# Collections: Research_competitor (root) + Domain (via explicit reference)
collections:
  - collection: Research_competitor
    required: true
    primary: true
    field_set: [standard, extended, array]
    references:
      domainBeacon:
        target_collection: Domain
        field_set: [standard]

  - collection: Domain
    field_set: [standard]
    via_reference: domainBeacon

# Chat integration
chat_integration:
  best_for:
    - "Competitor intelligence for single entity"
    - "Fast testing of parallel array rendering"
    - "Focused competitive analysis"

  usage_patterns:
    - "Starts from Research_competitor"
    - "Traverses to Domain via domainBeacon"
    - "NO auto-discovery - only competitor + domain"
    - "Fast execution - single researcher"

  parameter_examples:
    - name: "Single entity competitor intel"
      params: {where: {domain: "example.com"}}

# Response structure
response_structure:
  root_object: Research_competitor
  includes_relationships: true
  relationship_style: explicit_only
  field_focus: competitor_research
  expected_collections:
    - Research_competitor
    - Domain

# Documentation
documentation:
  overview: |
    Competitor-focused data card using Research_competitor as root.
    
    KEY INSIGHT: 
    - relationship_traversal: true (allows explicit refs)
    - dynamic_templates: false (prevents auto-discovery)
    
    This combination ensures only Research_competitor → Domain is traversed,
    NOT Domain → all other Research_* collections.
    
    FIELD SET BEHAVIOR:
    - standard: Core fields (Cat, key scalars, core parallel arrays)
    - extended: Deep-dive fields (LLM analysis, detailed arrays, scores)
    - array: All array fields (required for parallel array tables)
    
  field_sets: |
    STANDARD ARRAYS (field_set: [standard, array]):
    - keyCompetitors (primary)
    - competitorDomain (parallel)
    - competitorPositioning (parallel)
    - competitorTargetMarket (parallel)
    - competitorPriceVs (parallel)
    - competitorAdvantagesVs (parallel)
    - differentiationFactors
    - competitiveAdvantages
    
    EXTENDED ARRAYS (field_set: [standard, extended, array]):
    - competitorGapsVs (parallel)
    - competitiveThreats
    - marketTrends
    - marketStrengthScore (parallel)
    - innovationScore (parallel)
    - threatLevelScore (parallel)
    
    SYSTEM ARRAYS (not in reports):
    - keyCompetitorsIds
    - keyCompetitorEvidence
    - citations
    - reasoning
