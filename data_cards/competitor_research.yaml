id: competitor_research
collection: Research_competitor  # ✅ ROOT = Researcher, not Domain
name: Competitor Research
type: data_card
file: competitor_research.yaml
description: >
  Fetch Research_competitor with explicit Domain reference.
  CRITICAL: Uses dynamic_templates=false to PREVENT auto-discovery
  of Domain's references to other Research_* collections.
  
  Traversal path:
    Research_competitor → Domain (via sourceEntity) ← STOPS HERE
    Domain → Research_* ← NOT traversed (dynamic_templates=false)

tags:
  - research
  - competitor
  - entity-intelligence
  - focused

target_scope: entity_intelligence
executor: fetch
display: true
relationship_support: true

personas:
  - "*"

parameters:
  type: fetch
  collection: Research_competitor
  
  # ✅ CRITICAL: relationship_traversal=true + dynamic_templates=false
  # This means: "traverse ONLY explicit references, no auto-discovery"
  relationship_traversal: true   # ✅ Allow traversal to Domain
  dynamic_templates: false       # ✅ PREVENT auto-discovery of Domain→Research_*
  
  limit: 10000
  limit_default: 10000
  field_set: [standard, extended, array]

fields: {}

field_tags:
  - Cat
  - LLM
  - research

# Explicit collections with references (no auto-discovery)
collections:
  - collection: Research_competitor
    required: true
    primary: true
    field_set: [standard, extended, array]
    references:
      sourceEntity:
        target_collection: Domain
        field_set: [standard]  # Only core Domain fields

  - collection: Domain
    field_set: [standard]
    via_reference: sourceEntity

chat_integration:
  best_for:
    - "Competitor intelligence for single entity"
    - "Fast testing of parallel array rendering"
    - "Focused competitive analysis"

  usage_patterns:
    - "Starts from Research_competitor, traverses to Domain only"
    - "dynamic_templates=false prevents Discovery→ALL Research_*"
    - "Returns ONLY competitor + domain data"
    - "Fast execution - single researcher"

  parameter_examples:
    - name: "Single entity competitor intel"
      params: {where: {domain: "example.com"}}

response_structure:
  root_object: Research_competitor
  includes_relationships: true
  relationship_style: forward_traversal  # Researcher → Domain only
  field_focus: competitor_research
  expected_collections:
    - Research_competitor
    - Domain

documentation:
  overview: |
    Single-researcher data card for focused competitor intelligence.
    
    KEY ARCHITECTURE:
    - Root: Research_competitor (NOT Domain)
    - relationship_traversal: true (allow traversal)
    - dynamic_templates: false (PREVENT auto-discovery)
    
    This ensures we only get:
    - Research_competitor fields (with arrays)
    - Domain fields (core info only)
    
    We do NOT get:
    - Research_industry, Research_financial, Research_leadership, etc.
    
  field_sets: |
    STANDARD ARRAYS (field_set: [standard, array]):
    - keyCompetitors (primary)
    - competitorDomain (parallel)
    - competitorPositioning (parallel)
    - competitorTargetMarket (parallel)
    - competitorPriceVs (parallel)
    - competitorAdvantagesVs (parallel)
    - differentiationFactors
    - competitiveAdvantages
    
    EXTENDED ARRAYS (field_set: [standard, extended, array]):
    - competitorGapsVs (parallel)
    - competitiveThreats
    - marketTrends
    - marketStrengthScore (parallel)
    - innovationScore (parallel)
    - threatLevelScore (parallel)
    
    SYSTEM ARRAYS (not in reports):
    - keyCompetitorsIds
    - keyCompetitorEvidence
    - citations
    - reasoning
