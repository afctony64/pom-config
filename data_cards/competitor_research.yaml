id: competitor_research
collection: Research_competitor  # ✅ ROOT = Researcher, not Domain
name: Competitor Research
type: data_card
file: competitor_research.yaml
description: >
  Fetch Research_competitor records with Domain via explicit reference.
  Starts from Research_competitor and traverses to Domain via domainBeacon.
  dynamic_templates: false prevents auto-discovery of Domain's other references.

tags:
  - research
  - competitor
  - entity-intelligence
  - focused

target_scope: entity_intelligence
executor: fetch
display: true
relationship_support: true

personas:
  - "*"

parameters:
  type: fetch
  collection: Research_competitor
  relationship_traversal: true   # ✅ Allow explicit reference traversal
  dynamic_templates: false       # ✅ DISABLE auto-discovery
  limit: 10000
  limit_default: 10000
  field_set: [standard, extended, array]

fields: {}

field_tags:
  - Cat
  - LLM
  - research

collections:
  - collection: Research_competitor
    required: true
    primary: true
    field_set: [standard, extended, array]
    references:
      domainBeacon:
        target_collection: Domain
        field_set: [standard]
      keyCompetitorRefs:
        target_collection: Domain
        field_set: [standard]
        description: "Traverse to competitor Domain records (parallel to keyCompetitors)"

  - collection: Domain
    field_set: [standard]
    via_reference: domainBeacon

  # Competitor Domain records reached via keyCompetitorRefs
  - collection: Domain
    alias: CompetitorDomain
    field_set: [standard]
    via_reference: keyCompetitorRefs

chat_integration:
  best_for:
    - "Competitor intelligence for single entity"
    - "Fast testing of parallel array rendering"
    - "Focused competitive analysis"

  usage_patterns:
    - "Starts from Research_competitor"
    - "Traverses to Domain via domainBeacon"
    - "NO auto-discovery - only competitor + domain"

  parameter_examples:
    - name: "Single entity competitor intel"
      params: {where: {domain: "example.com"}}

response_structure:
  root_object: Research_competitor
  includes_relationships: true
  relationship_style: explicit_only
  expected_collections:
    - Research_competitor
    - Domain
    - CompetitorDomain  # Competitor entities via keyCompetitorRefs

documentation:
  overview: |
    Competitor-focused data card using Research_competitor as root.
    
    KEY: 
    - relationship_traversal: true (allows explicit refs)
    - dynamic_templates: false (prevents auto-discovery)
    
    TRAVERSAL PATHS:
    1. Research_competitor → Domain (via domainBeacon) = source entity
    2. Research_competitor → Domain[] (via keyCompetitorRefs) = competitor entities
    
    The keyCompetitorRefs allows traversal to each competitor's Domain record,
    enabling access to competitor entity data (title, description, content, etc.)
