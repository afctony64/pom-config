id: customer_research
collection: Research_customer  # ✅ ROOT = Researcher, not Domain
name: Customer Research
type: data_card
file: customer_research.yaml
description: >
  Customer intelligence with customer segment analysis and key customer traversal.
  Starts from Research_customer, traverses to customer Domain records via keyCustomerRefs,
  then traverses to each customer's research data (industry, financial, product, etc.).

tags:
  - research
  - customer
  - entity-intelligence
  - deep-traversal

target_scope: entity_intelligence
executor: fetch
display: true
relationship_support: true

personas:
  - "*"

parameters:
  type: fetch
  collection: Research_customer
  relationship_traversal: true   # ✅ Allow explicit reference traversal
  dynamic_templates: false       # ✅ DISABLE auto-discovery (we define all paths)
  limit: 10000
  limit_default: 10000
  field_set: [standard, extended, array]
  # NOTE: keyCustomerRefs reference does NOT exist in Research_customer schema
  # Only domainBeacon reference is available
  # TODO: Add keyCustomerRefs to Research_customer schema if customer entity traversal is needed

  # Traversal depth for domainBeacon → Domain
  traversal:
    max_depth: 1                   # Research_customer → Domain → STOP
    max_complexity: 100
    policies:
      domainBeacon: skip           # Skip circular Domain refs from researchers

fields: {}

field_tags:
  - Cat
  - LLM
  - research

collections:
  # ==========================================================================
  # ROOT: Source entity's customer research
  # ==========================================================================
  - collection: Research_customer
    required: true
    primary: true
    field_set: [standard, extended, array]
    references:
      domainBeacon:
        target_collection: Domain
        field_set: [standard]
      # NOTE: keyCustomerRefs does NOT exist in Research_customer schema
      # Unlike Research_competitor which HAS keyCompetitorRefs
      # Customer entity traversal not available until schema is updated

  # ==========================================================================
  # Source entity's Domain
  # ==========================================================================
  - collection: Domain
    field_set: [standard]
    via_reference: domainBeacon

chat_integration:
  best_for:
    - "Customer segment intelligence"
    - "Key customer analysis and profiles"
    - "Use case and value proposition research"

  usage_patterns:
    - "Starts from Research_customer (source entity)"
    - "Traverses to source Domain via domainBeacon"
    - "NOTE: keyCustomerRefs traversal NOT available (reference not in schema)"
    - "Returns customer research for source entity only"

  parameter_examples:
    - name: "Full customer intelligence"
      params: {where: {domain: "example.com"}}

response_structure:
  root_object: Research_customer
  includes_relationships: true
  relationship_style: explicit_only
  expected_collections:
    - Research_customer        # Source entity's customer analysis
    - Domain                   # Source entity's Domain
    # NOTE: CustomerDomain traversal NOT available (keyCustomerRefs not in schema)

documentation:
  overview: |
    Customer intelligence data card.
    
    CURRENT STATE (Schema Limitation):
    Research_customer only has 'domainBeacon' reference (no keyCustomerRefs).
    Unlike Research_competitor which HAS keyCompetitorRefs for competitor entity traversal.
    
    TRAVERSAL PATHS:
    1. Research_customer → Domain (source entity info via domainBeacon)
    
    RESULT: Customer research for source entity only.
    
    TODO: Add keyCustomerRefs reference to Research_customer schema to enable
    customer entity traversal similar to competitor_research data card.
